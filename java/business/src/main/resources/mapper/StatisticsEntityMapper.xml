<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.anji.allways.business.mapper.StatisticsEntityMapper">
	<resultMap id="BaseResultMap"
		type="com.anji.allways.business.entity.StatisticsEntity">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Wed Aug 23 
			17:12:20 CST 2017. -->
		<id column="id" property="id" jdbcType="INTEGER" />
		<result column="date" property="date" jdbcType="DATE" />
		<result column="warehouse_id" property="warehouseId" jdbcType="INTEGER" />
		<result column="customer_id" property="customerId" jdbcType="INTEGER" />
		<result column="warehouse_amount" property="warehouseAmount"
			jdbcType="INTEGER" />
		<result column="storage_amount" property="storageAmount"
			jdbcType="INTEGER" />
		<result column="incoming_amount" property="incomingAmount"
			jdbcType="INTEGER" />
		<result column="order_amount" property="orderAmount" jdbcType="INTEGER" />
		<result column="delivery_amount" property="deliveryAmount" jdbcType="INTEGER" />
		<result column="received_amount" property="receivedAmount" jdbcType="INTEGER" />
		<result column="receiving_amount" property="receivingAmount" jdbcType="INTEGER" />
		<result column="type" property="type" jdbcType="INTEGER" />
		<result column="age_1_9_amount" property="age19Amount"
			jdbcType="INTEGER" />
		<result column="age_10_19_amount" property="age1019Amount"
			jdbcType="INTEGER" />
		<result column="age_20_29_amount" property="age2029Amount"
			jdbcType="INTEGER" />
		<result column="age_30_45_amount" property="age3045Amount"
			jdbcType="INTEGER" />
		<result column="age_46_60_amount" property="age4660Amount"
			jdbcType="INTEGER" />
		<result column="age_over_60_amount" property="ageOver60Amount"
			jdbcType="INTEGER" />
		<result column="reserved" property="reserved" jdbcType="VARCHAR" />
		<result column="warehouseName" property="warehouseName" jdbcType="VARCHAR" />
	</resultMap>
	<sql id="Base_Column_List">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Wed Aug 23 
			17:12:20 CST 2017. -->
		id, date, warehouse_id, customer_id, warehouse_amount, storage_amount,
		incoming_amount,
		order_amount, delivery_amount, receiving_amount, received_amount,type,
		age_1_9_amount, age_10_19_amount,
		age_20_29_amount, age_30_45_amount,
		age_46_60_amount,
		age_over_60_amount, reserved
	</sql>
	<select id="selectByPrimaryKey" resultMap="BaseResultMap"
		parameterType="java.lang.Integer">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Wed Aug 23 
			17:12:20 CST 2017. -->
		select
		<include refid="Base_Column_List" />
		from tb_statistics
		where id = #{id,jdbcType=INTEGER}
	</select>
	<delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Wed Aug 23 
			17:12:20 CST 2017. -->
		delete from tb_statistics
		where id = #{id,jdbcType=INTEGER}
	</delete>
	<insert id="insert" parameterType="com.anji.allways.business.entity.StatisticsEntity">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Wed Aug 23 
			17:12:20 CST 2017. -->
		insert into tb_statistics (id, date, warehouse_id,
		customer_id,
		warehouse_amount, storage_amount,
		incoming_amount, order_amount,
		delivery_amount,
		received_amount,
		receiving_amount,
		type,
		age_1_9_amount, 
		age_10_19_amount,
		age_20_29_amount, 
		age_30_45_amount, 
		age_46_60_amount,
		age_over_60_amount, reserved)
		values (#{id,jdbcType=INTEGER},
		#{date,jdbcType=DATE},
		#{warehouseId,jdbcType=INTEGER},
		#{customerId,jdbcType=INTEGER}, #{warehouseAmount,jdbcType=INTEGER},
		#{storageAmount,jdbcType=INTEGER},
		#{incomingAmount,jdbcType=INTEGER},
		#{orderAmount,jdbcType=INTEGER},
		#{deliveryAmount,jdbcType=INTEGER},
		#{receivedAmount,jdbcType=INTEGER},
		#{receivingAmount,jdbcType=INTEGER},
		#{type,jdbcType=INTEGER},
		#{age19Amount,jdbcType=INTEGER},
		#{age1019Amount,jdbcType=INTEGER},
		#{age2029Amount,jdbcType=INTEGER},
		#{age3045Amount,jdbcType=INTEGER}, #{age4660Amount,jdbcType=INTEGER},
		#{ageOver60Amount,jdbcType=INTEGER}, #{reserved,jdbcType=VARCHAR})
	</insert>
	<insert id="insertSelective" parameterType="com.anji.allways.business.entity.StatisticsEntity">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Wed Aug 23 
			17:12:20 CST 2017. -->
		insert into tb_statistics
		<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="id != null">
				id,
			</if>
			<if test="date != null">
				date,
			</if>
			<if test="warehouseId != null">
				warehouse_id,
			</if>
			<if test="customerId != null">
				customer_id,
			</if>
			<if test="warehouseAmount != null">
				warehouse_amount,
			</if>
			<if test="storageAmount != null">
				storage_amount,
			</if>
			<if test="incomingAmount != null">
				incoming_amount,
			</if>
			<if test="orderAmount != null">
				order_amount,
			</if>
			<if test="deliveryAmount != null">
				delivery_amount,
			</if>
			<if test="receivedAmount != null">
				received_amount,
			</if>
			<if test="receivingAmount != null">
				receiving_amount,
			</if>
			<if test="type != null">
				type,
			</if>
			<if test="age19Amount != null">
				age_1_9_amount,
			</if>
			<if test="age1019Amount != null">
				age_10_19_amount,
			</if>
			<if test="age2029Amount != null">
				age_20_29_amount,
			</if>
			<if test="age3045Amount != null">
				age_30_45_amount,
			</if>
			<if test="age4660Amount != null">
				age_46_60_amount,
			</if>
			<if test="ageOver60Amount != null">
				age_over_60_amount,
			</if>
			<if test="reserved != null">
				reserved,
			</if>
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=",">
			<if test="id != null">
				#{id,jdbcType=INTEGER},
			</if>
			<if test="date != null">
				#{date,jdbcType=DATE},
			</if>
			<if test="warehouseId != null">
				#{warehouseId,jdbcType=INTEGER},
			</if>
			<if test="customerId != null">
				#{customerId,jdbcType=INTEGER},
			</if>
			<if test="warehouseAmount != null">
				#{warehouseAmount,jdbcType=INTEGER},
			</if>
			<if test="storageAmount != null">
				#{storageAmount,jdbcType=INTEGER},
			</if>
			<if test="incomingAmount != null">
				#{incomingAmount,jdbcType=INTEGER},
			</if>
			<if test="orderAmount != null">
				#{orderAmount,jdbcType=INTEGER},
			</if>
			<if test="deliveryAmount != null">
				#{deliveryAmount,jdbcType=INTEGER},
			</if>
			<if test="receivedAmount != null">
				#{receivedAmount,jdbcType=INTEGER},
			</if>
			<if test="receivingAmount != null">
				#{receivingAmount,jdbcType=INTEGER},
			</if>
			<if test="type != null">
				#{type,jdbcType=INTEGER},
			</if>
			<if test="age19Amount != null">
				#{age19Amount,jdbcType=INTEGER},
			</if>
			<if test="age1019Amount != null">
				#{age1019Amount,jdbcType=INTEGER},
			</if>
			<if test="age2029Amount != null">
				#{age2029Amount,jdbcType=INTEGER},
			</if>
			<if test="age3045Amount != null">
				#{age3045Amount,jdbcType=INTEGER},
			</if>
			<if test="age4660Amount != null">
				#{age4660Amount,jdbcType=INTEGER},
			</if>
			<if test="ageOver60Amount != null">
				#{ageOver60Amount,jdbcType=INTEGER},
			</if>
			<if test="reserved != null">
				#{reserved,jdbcType=VARCHAR},
			</if>
		</trim>
	</insert>
	<update id="updateByPrimaryKeySelective" parameterType="com.anji.allways.business.entity.StatisticsEntity">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Wed Aug 23 
			17:12:20 CST 2017. -->
		update tb_statistics
		<set>
			<if test="date != null">
				date = #{date,jdbcType=DATE},
			</if>
			<if test="warehouseId != null">
				warehouse_id = #{warehouseId,jdbcType=INTEGER},
			</if>
			<if test="customerId != null">
				customer_id = #{customerId,jdbcType=INTEGER},
			</if>
			<if test="warehouseAmount != null">
				warehouse_amount = #{warehouseAmount,jdbcType=INTEGER},
			</if>
			<if test="storageAmount != null">
				storage_amount = #{storageAmount,jdbcType=INTEGER},
			</if>
			<if test="incomingAmount != null">
				incoming_amount = #{incomingAmount,jdbcType=INTEGER},
			</if>
			<if test="orderAmount != null">
				order_amount = #{orderAmount,jdbcType=INTEGER},
			</if>
			<if test="deliveryAmount != null">
				delivery_amount = #{deliveryAmount,jdbcType=INTEGER},
			</if>
			<if test="receivedAmount != null">
				received_amount = #{receivedAmount,jdbcType=INTEGER},
			</if>
			<if test="receivingAmount != null">
				receiving_amount = #{receivingAmount,jdbcType=INTEGER},
			</if>
			<if test="type != null">
				type = #{type,jdbcType=INTEGER},
			</if>
			<if test="age19Amount != null">
				age_1_9_amount = #{age19Amount,jdbcType=INTEGER},
			</if>
			<if test="age1019Amount != null">
				age_10_19_amount = #{age1019Amount,jdbcType=INTEGER},
			</if>
			<if test="age2029Amount != null">
				age_20_29_amount = #{age2029Amount,jdbcType=INTEGER},
			</if>
			<if test="age3045Amount != null">
				age_30_45_amount = #{age3045Amount,jdbcType=INTEGER},
			</if>
			<if test="age4660Amount != null">
				age_46_60_amount = #{age4660Amount,jdbcType=INTEGER},
			</if>
			<if test="ageOver60Amount != null">
				age_over_60_amount = #{ageOver60Amount,jdbcType=INTEGER},
			</if>
			<if test="reserved != null">
				reserved = #{reserved,jdbcType=VARCHAR},
			</if>
		</set>
		where id = #{id,jdbcType=INTEGER}
	</update>
	<update id="updateByPrimaryKey" parameterType="com.anji.allways.business.entity.StatisticsEntity">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Wed Aug 23 
			17:12:20 CST 2017. -->
		update tb_statistics
		set date = #{date,jdbcType=DATE},
		warehouse_id =
		#{warehouseId,jdbcType=INTEGER},
		customer_id =
		#{customerId,jdbcType=INTEGER},
		warehouse_amount =
		#{warehouseAmount,jdbcType=INTEGER},
		storage_amount =
		#{storageAmount,jdbcType=INTEGER},
		incoming_amount =
		#{incomingAmount,jdbcType=INTEGER},
		order_amount =
		#{orderAmount,jdbcType=INTEGER},
		delivery_amount =
		#{deliveryAmount,jdbcType=INTEGER},
		received_amount =
		#{receivedAmount,jdbcType=INTEGER},
		receiving_amount =
		#{receivingAmount,jdbcType=INTEGER},
		type = 
		#{type,jdbcType=INTEGER},
		age_1_9_amount =
		#{age19Amount,jdbcType=INTEGER},
		age_10_19_amount =
		#{age1019Amount,jdbcType=INTEGER},
		age_20_29_amount =
		#{age2029Amount,jdbcType=INTEGER},
		age_30_45_amount =
		#{age3045Amount,jdbcType=INTEGER},
		age_46_60_amount =
		#{age4660Amount,jdbcType=INTEGER},
		age_over_60_amount =
		#{ageOver60Amount,jdbcType=INTEGER},
		reserved =
		#{reserved,jdbcType=VARCHAR}
		where id = #{id,jdbcType=INTEGER}
	</update>
	<!-- 统计统一MAP -->
	<resultMap type="com.anji.allways.business.vo.StatisticsEntityResponseVo"
		id="statisticsResultMap">
		<result property="customerId" column="customer_id" />
		<result property="count" column="sCount" />
		<result property="warehouseId" column="warehouse_id" />
		<result property="dealerId" column="dealer_id" />
		<result property="storageTime" column="storage_time" />
	</resultMap>
	<!-- 获取库位数 -->
	<select id="queryStorgeCount"
		parameterType="com.anji.allways.business.vo.StatisticsEntityResquestVo"
		resultMap="statisticsResultMap">
		SELECT
		wlc.customer_id,
		SUM(wlc.space_amount) AS sCount
		FROM
		tb_warehouse_link_customer wlc
		WHERE
		wlc.warehouse_id IN
		<foreach collection="Starquest.warehouseIds" index="index"
			item="item" open="(" separator="," close=")">
			#{item}
		</foreach>
		GROUP BY wlc.customer_id
		order by wlc.customer_id DESC
	</select>
	<!-- 获取入库数 -->
	<select id="queryStorgingCount"
		parameterType="com.anji.allways.business.vo.StatisticsEntityResquestVo"
		resultMap="statisticsResultMap">
		SELECT
		p.customer_id,
		COUNT(p.id) AS sCount
		FROM
		tb_storage_plan p
		WHERE
		p.`status` = 2
		AND DATE_FORMAT(p.storage_time,'%Y-%m-%d') =
		#{Starquest.requestData}
		AND p.warehouse_id IN
		<foreach collection="Starquest.warehouseIds" index="index"
			item="item" open="(" separator="," close=")">
			#{item}
		</foreach>
		GROUP BY p.customer_id
		order by p.customer_id DESC
	</select>
	<!-- 获取订单数 -->
	<select id="queryOrderCount"
		parameterType="com.anji.allways.business.vo.StatisticsEntityResquestVo"
		resultMap="statisticsResultMap">
		SELECT
		o.customer_id,
		COUNT(o.id) AS sCount
		FROM tb_order o
		WHERE
		DATE_FORMAT(o.create_time,'%Y-%m-%d') = #{Starquest.requestData}
		AND
		o.warehouse_id IN
		<foreach collection="Starquest.warehouseIds" index="index"
			item="item" open="(" separator="," close=")">
			#{item}
		</foreach>
		GROUP BY o.customer_id
		order by o.customer_id DESC
	</select>
	<!-- 获取出库单数 -->
	<select id="queryOutStorgeCount"
		parameterType="com.anji.allways.business.vo.StatisticsEntityResquestVo"
		resultMap="statisticsResultMap">
		SELECT
		o.customer_id,
		COUNT(o.id) AS sCount
		FROM tb_order o
		INNER JOIN
		tb_delivery_plan plan ON o.delivery_plan_id = plan.id
		WHERE o.`status`
		IN (4, 5)
		AND DATE_FORMAT(plan.delivery_time,'%Y-%m-%d') =
		#{Starquest.requestData}
		AND plan.warehouse_id IN
		<foreach collection="Starquest.warehouseIds" index="index"
			item="item" open="(" separator="," close=")">
			#{item}
		</foreach>
		GROUP BY o.customer_id
		order by o.customer_id DESC
	</select>
	<!-- 查询客户收车数 -->
	<select id="queryCustomerGetCarCount"
		parameterType="com.anji.allways.business.vo.StatisticsEntityResquestVo"
		resultMap="statisticsResultMap">
		SELECT
		o.customer_id,
		COUNT(o.id) AS sCount
		FROM tb_order o
		WHERE
		DATE_FORMAT(o.receive_time,'%Y-%m-%d') = #{Starquest.requestData}
		AND
		o.warehouse_id IN
		<foreach collection="Starquest.warehouseIds" index="index"
			item="item" open="(" separator="," close=")">
			#{item}
		</foreach>
		GROUP BY o.customer_id
		order by o.customer_id DESC
	</select>
	<!-- 查询库存数 -->
	<select id="queryStorageedCarCount"
		parameterType="com.anji.allways.business.vo.StatisticsEntityResquestVo"
		resultMap="statisticsResultMap">
		SELECT
		v.dealer_id AS customer_id,
		COUNT(v.id) AS sCount
		FROM
		tb_vehicle v
		WHERE DATE_FORMAT(v.create_time,'%Y-%m-%d') = #{Starquest.requestData}
		AND v.vehicle_status IN (0,1,2,3)
		AND v.warehouse_id IN
		<foreach collection="Starquest.warehouseIds" index="index"
			item="item" open="(" separator="," close=")">
			#{item}
		</foreach>
		GROUP BY v.dealer_id
		order by v.dealer_id DESC
	</select>
	<!-- 查询待收车数 -->
	<select id="selectWaitingCarCount" 
	    parameterType="com.anji.allways.business.vo.StatisticsEntityResquestVo"
		resultMap="statisticsResultMap">
	    SELECT
					v.dealer_id AS customer_id,
					COUNT(v.id) AS sCount
		FROM        tb_vehicle v
		WHERE       DATE_FORMAT(v.create_time,'%Y-%m-%d') = #{Starquest.requestData}
		AND         v.vehicle_status IN (4,7,9)
		AND         v.warehouse_id IN
					<foreach collection="Starquest.warehouseIds" index="index"
						item="item" open="(" separator="," close=")">
						#{item}
					</foreach>
		GROUP BY    v.dealer_id
		order by    v.dealer_id DESC
	</select>
	<!-- 查询在库时间 -->
	<select id="selectStayTime"
		parameterType="com.anji.allways.business.vo.StatisticsEntityResquestVo"
		resultMap="statisticsResultMap">
		SELECT
				    v.dealer_id,
				    v.warehouse_id,
				    o.storage_time
		FROM
				    tb_order o,
				    tb_vehicle v
		WHERE       o.vehicle_id = v.id
        AND         v.vehicle_status IN (0,1,2,3)
		AND         v.dealer_id = #{Starquest.dealerId}
		AND         v.warehouse_id IN
		<foreach collection="Starquest.warehouseIds" index="index"
			item="item" open="(" separator="," close=")">
			#{item}
		</foreach>
		ORDER BY    v.create_time DESC
	</select>
	<!-- 查询出库时间 -->
	<select id="selectOutTime"
		parameterType="com.anji.allways.business.vo.StatisticsEntityResquestVo"
		resultMap="statisticsResultMap">
        SELECT
				    v.dealer_id,
				    v.warehouse_id,
				    o.storage_time,
                    o.delivery_time
		FROM
				    tb_order o,
				    tb_vehicle v
		WHERE       o.vehicle_id = v.id
		AND         v.vehicle_status IN (4,5,7,9)
		ORDER BY    v.create_time DESC
	</select>
	<select id="selectByDateAndWarehouseIdAndCustomerIdOne"
		parameterType="java.util.Map"
		resultType="com.anji.allways.business.entity.StatisticsEntity">
        SELECT a.*,b.name AS warehouseName FROM tb_statistics a
		LEFT JOIN tb_warehouse b ON b.id = a.warehouse_id
        WHERE a.warehouse_id = #{warehouseId,jdbcType=INTEGER}  AND a.customer_id = (SELECT customer_id FROM tb_user WHERE id = #{customerId,jdbcType=INTEGER}) AND	a.DATE = #{date,jdbcType=VARCHAR} AND a.type=1
	</select>
	
	<select id="selectByDateAndWarehouseIdAndCustomerIdTwo"
		parameterType="java.util.Map"
		resultType="com.anji.allways.business.entity.StatisticsEntity">
        SELECT a.*,b.name AS warehouseName FROM tb_statistics a
		LEFT JOIN tb_warehouse b ON b.id = a.warehouse_id
        WHERE a.warehouse_id = #{warehouseId,jdbcType=INTEGER}  AND a.customer_id = (SELECT customer_id FROM tb_user WHERE id = #{customerId,jdbcType=INTEGER})  AND	a.DATE = #{date,jdbcType=VARCHAR} AND a.type=2
	</select>
	
	<select id="selectByDateAndAndCustomerIdOne"
		parameterType="java.util.Map"
		resultType="com.anji.allways.business.entity.StatisticsEntity">
        SELECT a.*,b.name AS warehouseName FROM tb_statistics a
		LEFT JOIN tb_warehouse b ON b.id = a.warehouse_id
		WHERE a.customer_id = (SELECT customer_id FROM tb_user WHERE id = #{customerId,jdbcType=INTEGER}) AND a.DATE = #{date,jdbcType=VARCHAR} AND a.warehouse_id =0 AND a.type=1
	</select>
	
	<select id="selectByDateAndAndCustomerIdTwo"
		parameterType="java.util.Map"
		resultType="com.anji.allways.business.entity.StatisticsEntity">
        SELECT a.*,b.name AS warehouseName FROM tb_statistics a
		LEFT JOIN tb_warehouse b ON b.id = a.warehouse_id
		WHERE a.customer_id = (SELECT customer_id FROM tb_user WHERE id = #{customerId,jdbcType=INTEGER}) AND a.DATE = #{date,jdbcType=VARCHAR} AND a.warehouse_id =0 AND a.type=2
	</select>
	
	<select id="selectAllWarehouse"
		parameterType="java.util.Map"
		resultType="com.anji.allways.business.entity.StatisticsEntity">
        SELECT a.*,b.name AS warehouseName FROM tb_statistics a
		LEFT JOIN tb_warehouse b ON b.id=a.warehouse_id 
		WHERE a.customer_id = (SELECT customer_id FROM tb_user WHERE id = #{customerId,jdbcType=INTEGER}) AND a.DATE = #{date,jdbcType=VARCHAR} AND a.warehouse_id !=0
        ORDER BY a.id DESC
	</select>
	
	<select id="selectAllStockByWarehouse"
		parameterType="java.util.Map"
		resultType="com.anji.allways.business.entity.StatisticsEntity">
        SELECT * FROM tb_statistics
	    WHERE warehouse_id = #{warehouseId,jdbcType=INTEGER} AND customer_id=#{customerId,jdbcType=INTEGER} AND DATE_SUB(CURDATE(), INTERVAL 7 DAY) &lt;=DATE ORDER BY DATE
	</select>
</mapper>