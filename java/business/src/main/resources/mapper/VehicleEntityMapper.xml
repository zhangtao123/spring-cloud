<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.anji.allways.business.mapper.VehicleEntityMapper">
	<resultMap id="BaseResultMap"
		type="com.anji.allways.business.entity.VehicleEntity">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Wed Aug 23 
			17:12:20 CST 2017. -->
		<id column="id" property="id" jdbcType="INTEGER" />
		<result column="warehouse_id" property="warehouseId" jdbcType="INTEGER" />
		<result column="dealer_id" property="dealerId" jdbcType="INTEGER" />
		<result column="storage_vehicle_id" property="storageVehicleId" jdbcType="INTEGER" />
		<result column="vin" property="vin" jdbcType="VARCHAR" />
		<result column="brand" property="brand" jdbcType="VARCHAR" />
		<result column="series" property="series" jdbcType="VARCHAR" />
		<result column="model" property="model" jdbcType="VARCHAR" />
		<result column="announce_year" property="announceYear"
			jdbcType="VARCHAR" />
		<result column="standard_color_id" property="standardColorId"
			jdbcType="INTEGER" />
		<result column="manufacturer_color" property="manufacturerColor"
			jdbcType="VARCHAR" />
		<result column="picture_path" property="picturePath" jdbcType="VARCHAR" />
		<result column="picture_number" property="pictureNumber"
			jdbcType="INTEGER" />
		<result column="license_number" property="licenseNumber"
			jdbcType="VARCHAR" />
		<result column="registration_number" property="registrationNumber"
			jdbcType="VARCHAR" />
		<result column="vehicle_type" property="vehicleType" jdbcType="INTEGER" />
		<result column="info" property="info" jdbcType="VARCHAR" />
		<result column="comment" property="comment" jdbcType="VARCHAR" />
		<result column="vehicle_status" property="vehicleStatus"
			jdbcType="INTEGER" />
		<result column="quality_status" property="qualityStatus"
			jdbcType="INTEGER" />
		<result column="lock_status" property="lockStatus" jdbcType="INTEGER" />
		<result column="create_user" property="createUser" jdbcType="INTEGER" />
		<result column="create_time" property="createTime" jdbcType="TIMESTAMP" />
		<result column="update_user" property="updateUser" jdbcType="INTEGER" />
		<result column="update_time" property="updateTime" jdbcType="TIMESTAMP" />
		<result column="reserved" property="reserved" jdbcType="VARCHAR" />
		<result column="dict_key" property="standardColor" jdbcType="VARCHAR" />
		<result column="warehouseName" property="warehouseName"
			jdbcType="VARCHAR" />
		<result column="location" property="location" jdbcType="VARCHAR" />
		<result column="customer" property="customer" jdbcType="VARCHAR" />
		<result column="userName" property="userName" jdbcType="VARCHAR" />
		<result column="planTime" property="planTime" jdbcType="TIMESTAMP" />
		<result column="contactor_mobile" property="contactorMobile"
			jdbcType="VARCHAR" />
		<result column="logo_picture_path" property="logoPicturePath"
			jdbcType="VARCHAR" />
		<result column="storage_plan_id" property="storagePlanId"
			jdbcType="INTEGER" />
		<result column="delivery_plan_id" property="deliveryPlanId"
			jdbcType="INTEGER" />
		<result column="storage_time" property="storageTime" jdbcType="TIMESTAMP" />
		<result column="operator" property="operatorName" jdbcType="VARCHAR" />
		<result column="delivery_time" property="deliveryTime"
			jdbcType="TIMESTAMP" />
		<result column="business_start_time" property="businessStartTime"
			jdbcType="VARCHAR" />
		<result column="business_end_time" property="businessendtime"
			jdbcType="VARCHAR" />
		<result column="transportNo" property="transportNo"
			jdbcType="VARCHAR" />
		<result column="transport_type" property="transportType"
			jdbcType="VARCHAR" />
		<result column="pickup_self_time" property="pickupSelfTime"
			jdbcType="VARCHAR" />
		<result column="orderId" property="orderId"
			jdbcType="INTEGER" />
		<result column="orderNo" property="orderNo"
			jdbcType="VARCHAR" />
			
	</resultMap>
	<resultMap id="StockVehicleResultMap"
		type="com.anji.allways.business.vo.VehicleVO">
        <id column="id" property="id" jdbcType="INTEGER" />
        <result column="vin" property="vin" jdbcType="VARCHAR" />
        <result column="brand" property="brand" jdbcType="VARCHAR" />
        <result column="series" property="series" jdbcType="VARCHAR" />
        <result column="model" property="model" jdbcType="VARCHAR" />
        <result column="standard_color_id" property="standardColorId"
            jdbcType="INTEGER" />
        <result column="warehouse_name" property="warehouseName" jdbcType="VARCHAR" />
        <result column="customer" property="customerName" jdbcType="VARCHAR" />
        <result column="location" property="location"
            jdbcType="VARCHAR" />
        <result column="storage_time" property="storageTime" jdbcType="TIMESTAMP" />
        <result column="delivery_time" property="deliveryTime"
            jdbcType="TIMESTAMP" />
        <result column="receive_time" property="receivedTime"
            jdbcType="TIMESTAMP" />
        <result column="operator_name" property="operatorName"
            jdbcType="VARCHAR" />
        <result column="vehicle_status" property="vehicleStatus"
            jdbcType="INTEGER" />
        <result column="lock_status" property="lockStatus" jdbcType="INTEGER" />
        <result column="standard_color_name" property="standardColorName" jdbcType="VARCHAR" />
        <result column="manufacturer_color" property="manufacturerColor" jdbcType="VARCHAR" />
	</resultMap>
	<sql id="Base_Column_List">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Wed Aug 23 
			17:12:20 CST 2017. -->
		id, warehouse_id, dealer_id,storage_vehicle_id, vin, brand, series, model, announce_year,
		standard_color_id,
		manufacturer_color, picture_path, picture_number,
		license_number, registration_number,
		vehicle_type, info, comment,
		vehicle_status, quality_status, lock_status, create_user, create_time,
		update_user,
		update_time, reserved
	</sql>
	<select id="selectByPrimaryKey" resultMap="BaseResultMap"
		parameterType="java.lang.Integer">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Wed Aug 23 
			17:12:20 CST 2017. -->
		select
		<include refid="Base_Column_List" />
		from tb_vehicle
		where id = #{id,jdbcType=INTEGER}
	</select>
	<delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Wed Aug 23 
			17:12:20 CST 2017. -->
		delete from tb_vehicle
		where id = #{id,jdbcType=INTEGER}
	</delete>
	<insert id="insert" parameterType="com.anji.allways.business.entity.VehicleEntity">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Wed Aug 23 
			17:12:20 CST 2017. -->
		insert into tb_vehicle (id, warehouse_id, dealer_id,
		storage_vehicle_id,
		vin, brand,
		series,
		model, announce_year, standard_color_id,
		manufacturer_color,
		picture_path, picture_number, license_number, registration_number,
		vehicle_type, info, comment,
		vehicle_status, quality_status,
		lock_status,
		create_user, create_time, update_user,
		update_time,
		reserved)
		values (#{id,jdbcType=INTEGER},
		#{warehouseId,jdbcType=INTEGER},
		#{dealerId,jdbcType=INTEGER},
		#{storageVehicleId,jdbcType=INTEGER},
		#{vin,jdbcType=VARCHAR}, #{brand,jdbcType=VARCHAR},
		#{series,jdbcType=VARCHAR},
		#{model,jdbcType=VARCHAR},
		#{announceYear,jdbcType=DATE},
		#{standardColorId,jdbcType=INTEGER},
		#{manufacturerColor,jdbcType=VARCHAR},#{picturePath,jdbcType=VARCHAR},#{pictureNumber,jdbcType=INTEGER},
		#{licenseNumber,jdbcType=VARCHAR},
		#{registrationNumber,jdbcType=VARCHAR},
		#{vehicleType,jdbcType=INTEGER},
		#{info,jdbcType=VARCHAR},
		#{comment,jdbcType=VARCHAR},
		#{vehicleStatus,jdbcType=INTEGER},
		#{qualityStatus,jdbcType=INTEGER},
		#{lockStatus,jdbcType=INTEGER},
		#{createUser,jdbcType=INTEGER},
		#{createTime,jdbcType=TIMESTAMP},
		#{updateUser,jdbcType=INTEGER},
		#{updateTime,jdbcType=TIMESTAMP},
		#{reserved,jdbcType=VARCHAR})
	</insert>
    <!-- insert id="insertBatch" parameterType="java.util.List">
    <foreach collection="vehicleList" item="item" index="index" open="" close="" separator=";">
        insert into tb_vehicle (id, warehouse_id, dealer_id,
        vin, brand,
        series,
        model, announce_year, standard_color_id,
        manufacturer_color,
        picture_path, picture_number, license_number, registration_number,
        vehicle_type, info, comment,
        vehicle_status, quality_status,
        lock_status,
        create_user, create_time, update_user,
        update_time,
        reserved)
        values (#{id,jdbcType=INTEGER},
        #{warehouseId,jdbcType=INTEGER},
        #{dealerId,jdbcType=INTEGER},
        #{vin,jdbcType=VARCHAR}, #{brand,jdbcType=VARCHAR},
        #{series,jdbcType=VARCHAR},
        #{model,jdbcType=VARCHAR},
        #{announceYear,jdbcType=DATE},
        #{standardColorId,jdbcType=INTEGER},
        #{manufacturerColor,jdbcType=VARCHAR},#{picturePath,jdbcType=VARCHAR},#{pictureNumber,jdbcType=INTEGER},
        #{licenseNumber,jdbcType=VARCHAR},
        #{registrationNumber,jdbcType=VARCHAR},
        #{vehicleType,jdbcType=INTEGER},
        #{info,jdbcType=VARCHAR},
        #{comment,jdbcType=VARCHAR},
        #{vehicleStatus,jdbcType=INTEGER},
        #{qualityStatus,jdbcType=INTEGER},
        #{lockStatus,jdbcType=INTEGER},
        #{createUser,jdbcType=INTEGER},
        #{createTime,jdbcType=TIMESTAMP},
        #{updateUser,jdbcType=INTEGER},
        #{updateTime,jdbcType=TIMESTAMP},
        #{reserved,jdbcType=VARCHAR})
     </foreach>
    </insert -->
	<insert id="insertSelective" parameterType="com.anji.allways.business.entity.VehicleEntity">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Wed Aug 23 
			17:12:20 CST 2017. -->
		insert into tb_vehicle
		<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="id != null">
				id,
			</if>
			<if test="warehouseId != null">
				warehouse_id,
			</if>
			<if test="dealerId != null">
				dealer_id,
			</if>
			<if test="storageVehicleId != null">
				storage_vehicle_id,
			</if>
			<if test="vin != null">
				vin,
			</if>
			<if test="brand != null">
				brand,
			</if>
			<if test="series != null">
				series,
			</if>
			<if test="model != null">
				model,
			</if>
			<if test="announceYear != null">
				announce_year,
			</if>
			<if test="standardColorId != null">
				standard_color_id,
			</if>
			<if test="manufacturerColor != null">
				manufacturer_color,
			</if>
			<if test="picturePath != null">
				picture_path,
			</if>
			<if test="pictureNumber != null">
				picture_number,
			</if>
			<if test="licenseNumber != null">
				license_number,
			</if>
			<if test="registrationNumber != null">
				registration_number,
			</if>
			<if test="vehicleType != null">
				vehicle_type,
			</if>
			<if test="info != null">
				info,
			</if>
			<if test="comment != null">
				comment,
			</if>
			<if test="vehicleStatus != null">
				vehicle_status,
			</if>
			<if test="qualityStatus != null">
				quality_status,
			</if>
			<if test="lockStatus != null">
				lock_status,
			</if>
			<if test="createUser != null">
				create_user,
			</if>
			<if test="createTime != null">
				create_time,
			</if>
			<if test="updateUser != null">
				update_user,
			</if>
			<if test="updateTime != null">
				update_time,
			</if>
			<if test="reserved != null">
				reserved,
			</if>
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=",">
			<if test="id != null">
				#{id,jdbcType=INTEGER},
			</if>
			<if test="warehouseId != null">
				#{warehouseId,jdbcType=INTEGER},
			</if>
			<if test="dealerId != null">
				#{dealerId,jdbcType=INTEGER},
			</if>
			<if test="storageVehicleId != null">
				#{storageVehicleId,jdbcType=INTEGER},
			</if>
			<if test="vin != null">
				#{vin,jdbcType=VARCHAR},
			</if>
			<if test="brand != null">
				#{brand,jdbcType=VARCHAR},
			</if>
			<if test="series != null">
				#{series,jdbcType=VARCHAR},
			</if>
			<if test="model != null">
				#{model,jdbcType=VARCHAR},
			</if>
			<if test="announceYear != null">
				#{announceYear,jdbcType=DATE},
			</if>
			<if test="standardColorId != null">
				#{standardColorId,jdbcType=INTEGER},
			</if>
			<if test="manufacturerColor != null">
				#{manufacturerColor,jdbcType=VARCHAR},
			</if>
			<if test="picturePath != null">
				#{picturePath,jdbcType=VARCHAR},
			</if>
			<if test="pictureNumber != null">
				#{pictureNumber,jdbcType=INTEGER},
			</if>
			<if test="licenseNumber != null">
				#{licenseNumber,jdbcType=VARCHAR},
			</if>
			<if test="registrationNumber != null">
				#{registrationNumber,jdbcType=VARCHAR},
			</if>
			<if test="vehicleType != null">
				#{vehicleType,jdbcType=INTEGER},
			</if>
			<if test="info != null">
				#{info,jdbcType=VARCHAR},
			</if>
			<if test="comment != null">
				#{comment,jdbcType=VARCHAR},
			</if>
			<if test="vehicleStatus != null">
				#{vehicleStatus,jdbcType=INTEGER},
			</if>
			<if test="qualityStatus != null">
				#{qualityStatus,jdbcType=INTEGER},
			</if>
			<if test="lockStatus != null">
				#{lockStatus,jdbcType=INTEGER},
			</if>
			<if test="createUser != null">
				#{createUser,jdbcType=INTEGER},
			</if>
			<if test="createTime != null">
				#{createTime,jdbcType=TIMESTAMP},
			</if>
			<if test="updateUser != null">
				#{updateUser,jdbcType=INTEGER},
			</if>
			<if test="updateTime != null">
				#{updateTime,jdbcType=TIMESTAMP},
			</if>
			<if test="reserved != null">
				#{reserved,jdbcType=VARCHAR},
			</if>
		</trim>
	</insert>
	<update id="updateByPrimaryKeySelective" parameterType="com.anji.allways.business.entity.VehicleEntity">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Wed Aug 23 
			17:12:20 CST 2017. -->
		update tb_vehicle
		<set>
			<if test="warehouseId != null">
				warehouse_id = #{warehouseId,jdbcType=INTEGER},
			</if>
			<if test="dealerId != null">
				dealer_id = #{dealerId,jdbcType=INTEGER},
			</if>
			<if test="storageVehicleId != null">
				storage_vehicle_id = #{storageVehicleId,jdbcType=INTEGER},
			</if>
			<if test="vin != null and vin !=''">
				vin = #{vin,jdbcType=VARCHAR},
			</if>
			<if test="brand != null and brand !=''">
				brand = #{brand,jdbcType=VARCHAR},
			</if>
			<if test="series != null and series !=''">
				series = #{series,jdbcType=VARCHAR},
			</if>
			<if test="model != null and model !=''">
				model = #{model,jdbcType=VARCHAR},
			</if>
			<if test="announceYear != null and announceYear !=''">
				announce_year = #{announceYear,jdbcType=VARCHAR},
			</if>
			<if test="standardColorId != null">
				standard_color_id = #{standardColorId,jdbcType=INTEGER},
			</if>
			<if test="manufacturerColor != null and manufacturerColor !=''">
				manufacturer_color =
				#{manufacturerColor,jdbcType=VARCHAR},
			</if>
			<if test="picturePath != null and picturePath !=''">
				picture_path = #{picturePath,jdbcType=VARCHAR},
			</if>
			<if test="pictureNumber != null">
				picture_number = #{pictureNumber,jdbcType=INTEGER},
			</if>
			<if test="licenseNumber != null and licenseNumber !=''">
				license_number = #{licenseNumber,jdbcType=VARCHAR},
			</if>
			<if test="registrationNumber != null and registrationNumber !=''">
				registration_number =
				#{registrationNumber,jdbcType=VARCHAR},
			</if>
			<if test="vehicleType != null">
				vehicle_type = #{vehicleType,jdbcType=INTEGER},
			</if>
			<if test="info != null and info !=''">
				info = #{info,jdbcType=VARCHAR},
			</if>
			<if test="comment != null and comment !=''">
				comment = #{comment,jdbcType=VARCHAR},
			</if>
			<if test="vehicleStatus != null">
				vehicle_status = #{vehicleStatus,jdbcType=INTEGER},
			</if>
			<if test="qualityStatus != null">
				quality_status = #{qualityStatus,jdbcType=INTEGER},
			</if>
			<if test="lockStatus != null">
				lock_status = #{lockStatus,jdbcType=INTEGER},
			</if>
			<if test="createUser != null">
				create_user = #{createUser,jdbcType=INTEGER},
			</if>
			<if test="createTime != null">
				create_time = #{createTime,jdbcType=TIMESTAMP},
			</if>
			<if test="updateUser != null">
				update_user = #{updateUser,jdbcType=INTEGER},
			</if>
			<if test="updateTime != null">
				update_time = #{updateTime,jdbcType=TIMESTAMP},
			</if>
			<if test="reserved != null and reserved !=''">
				reserved = #{reserved,jdbcType=VARCHAR},
			</if>
		</set>
		where id = #{id,jdbcType=INTEGER}
	</update>
	<update id="updateByPrimaryKey" parameterType="com.anji.allways.business.entity.VehicleEntity">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Wed Aug 23 
			17:12:20 CST 2017. -->
		update tb_vehicle
		set warehouse_id = #{warehouseId,jdbcType=INTEGER},
		dealer_id = #{dealerId,jdbcType=INTEGER},
		storage_vehicle_id = #{storageVehicleId,jdbcType=INTEGER},
		vin =
		#{vin,jdbcType=VARCHAR},
		brand = #{brand,jdbcType=VARCHAR},
		series =
		#{series,jdbcType=VARCHAR},
		model = #{model,jdbcType=VARCHAR},
		announce_year = #{announceYear,jdbcType=VARCHAR},
		standard_color_id =
		#{standardColorId,jdbcType=INTEGER},
		manufacturer_color =
		#{manufacturerColor,jdbcType=VARCHAR},
		picture_path =
		#{picturePath,jdbcType=VARCHAR},
		picture_number =
		#{pictureNumber,jdbcType=INTEGER},
		license_number =
		#{licenseNumber,jdbcType=VARCHAR},
		registration_number =
		#{registrationNumber,jdbcType=VARCHAR},
		vehicle_type =
		#{vehicleType,jdbcType=INTEGER},
		info = #{info,jdbcType=VARCHAR},
		comment =
		#{comment,jdbcType=VARCHAR},
		vehicle_status =
		#{vehicleStatus,jdbcType=INTEGER},
		quality_status =
		#{qualityStatus,jdbcType=INTEGER},
		lock_status =
		#{lockStatus,jdbcType=INTEGER},
		create_user =
		#{createUser,jdbcType=INTEGER},
		create_time =
		#{createTime,jdbcType=TIMESTAMP},
		update_user =
		#{updateUser,jdbcType=INTEGER},
		update_time =
		#{updateTime,jdbcType=TIMESTAMP},
		reserved =
		#{reserved,jdbcType=VARCHAR}
		where id = #{id,jdbcType=INTEGER}
	</update>

	<select id="selectAllVehicle" resultMap="BaseResultMap"
		parameterType="java.lang.Integer">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Wed Aug 23 
			17:12:20 CST 2017. -->
		SELECT a.*,b.name AS
		warehouseName,b.contactor_mobile,c.dict_key,d.location,e.name AS customer,f.name
		AS userName,a.create_time AS planTime,g.id AS orderId,h.storage_time FROM
		tb_vehicle a
		LEFT JOIN
		tb_warehouse b ON
		a.warehouse_id=b.id
		LEFT JOIN
		tb_dict c ON
		a.standard_color_id=c.id
		LEFT
		JOIN tb_storage_vehicle d ON
		a.storage_vehicle_id=d.id
		LEFT JOIN tb_storage_plan h ON h.id=d.storage_plan_id
		LEFT
		JOIN tb_user
		f ON a.create_user = f.id
		LEFT JOIN tb_customer e ON a.dealer_id=e.id
		LEFT JOIN tb_order g ON g.vehicle_id=a.id
		WHERE a.id= #{id,jdbcType=INTEGER} ORDER BY g.id DESC LIMIT 1
	</select>

	<select id="getOrderTransport" resultMap="BaseResultMap"
		parameterType="java.lang.Integer">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Wed Aug 23 
			17:12:20 CST 2017. -->
		SELECT a.id,a.vin,a.brand,a.series,a.model,a.announce_year,b.name AS
		warehouseName,e.customer,d.location,a.warehouse_id,f.id AS
		delivery_plan_id,
		d.id,e.storage_time,e.operator,f.delivery_time,b.business_start_time,b.business_end_time FROM tb_vehicle a
		LEFT JOIN tb_warehouse b ON a.warehouse_id=b.id
		LEFT JOIN
		tb_storage_vehicle d ON a.vin=d.vin
		LEFT JOIN tb_storage_plan e ON
		d.storage_plan_id=e.id
		LEFT JOIN tb_delivery_plan f ON d.delivery_plan_no = f.no
		LEFT JOIN tb_order h ON h.vehicle_id=a.id
		WHERE a.id = #{id,jdbcType=INTEGER} ORDER BY d.id DESC LIMIT 1
	</select>

	<select id="getCount" resultType="java.lang.Integer">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Wed Aug 23 
			17:12:20 CST 2017. -->
		SELECT COUNT(1) FROM tb_vehicle a
		LEFT JOIN tb_warehouse b ON a.warehouse_id=b.id
		LEFT JOIN
		tb_storage_vehicle d ON a.id=d.id
		LEFT JOIN tb_storage_plan e ON
		d.storage_plan_id=e.id
		LEFT JOIN tb_storage_plan f ON d.storage_plan_id = f.no
		LEFT JOIN tb_delivery_plan g ON d.delivery_plan_no=g.id
		WHERE a.dealer_id = (SELECT h.customer_id FROM tb_user h WHERE h.id = #{userId,jdbcType=INTEGER} )
		<if test="vehicleVtatus != null">
			AND a.vehicle_status in
			<foreach collection="vehicleVtatus" index="index" item="item"
				open="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
		<if test="vin != null and vin !=''">
			AND a.vin LIKE #{vin,jdbcType=VARCHAR}
		</if>
		<if test="brand != null and brand !=''">
			AND a.brand = #{brand,jdbcType=VARCHAR}
		</if>
		<if test="series != null and series !=''">
			AND a.series = #{series,jdbcType=VARCHAR}
		</if>
		<if test="model != null and model !=''">
			AND a.model= #{model,jdbcType=VARCHAR}
		</if>
		<if test="announceYear != null">
			AND a.announce_year in
			<foreach collection="announceYear" index="index" item="item"
				open="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
		<if test="standardColorId != null">
			AND a.standard_color_id in
			<foreach collection="standardColorId" index="index" item="item"
				open="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
		<if test="warehouseId != null">
			AND a.warehouse_id in
			<foreach collection="warehouseId" index="index" item="item"
				open="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
		<if test="qualityStatus != null">
			AND a.quality_status in
			<foreach collection="qualityStatus" index="index" item="item"
				open="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
		<if test="lockStatus != null">
			AND a.lock_status in
			<foreach collection="lockStatus" index="index" item="item"
				open="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
		<if test="deliveryStart != null and deliveryStart !=''">
			AND g.delivery_time &gt;= #{deliveryStart,jdbcType=VARCHAR}
		</if>
		<if test="deliveryEnd != null and deliveryEnd !=''">
			AND g.delivery_time &lt;= #{deliveryEnd,jdbcType=VARCHAR}
		</if>
		<if test="storageStart != null and storageStart !=''">
			AND f.storage_time &gt;= #{storageStart,jdbcType=VARCHAR}
		</if>
		<if test="storageEnd != null and storageEnd !=''">
			AND f.storage_time &lt;= #{storageEnd,jdbcType=VARCHAR}
		</if>
	</select>

	<select id="getStockDetail" resultMap="BaseResultMap">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Wed Aug 23 
			17:12:20 CST 2017. -->
		SELECT
		a.id,a.vin,a.brand,a.series,a.model,d.dict_key,a.manufacturer_color,a.vehicle_status,c.name
		as warehouseName
		,a.lock_status,a.announce_year
		FROM
		tb_vehicle a
		LEFT JOIN
		tb_warehouse c ON a.warehouse_id = c.id
		LEFT JOIN tb_dict d ON
		a.standard_color_id = d.id
		LEFT JOIN tb_storage_vehicle e ON a.storage_vehicle_id=e.id
		LEFT JOIN tb_storage_plan f ON e.storage_plan_id=f.id
		LEFT JOIN
		tb_delivery_plan g ON e.delivery_plan_no=g.id
		WHERE a.dealer_id = (SELECT h.customer_id FROM tb_user h WHERE h.id = #{userId,jdbcType=INTEGER} )
		<if test="vehicleVtatus != null">
			AND a.vehicle_status in
			<foreach collection="vehicleVtatus" index="index" item="item"
				open="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
		<if test="vin != null and vin !=''">
			AND a.vin LIKE #{vin,jdbcType=VARCHAR}
		</if>
		<if test="brand != null and brand !=''">
			AND a.brand = #{brand,jdbcType=VARCHAR}
		</if>
		<if test="series != null and series !=''">
			AND a.series = #{series,jdbcType=VARCHAR}
		</if>
		<if test="model != null and model !=''">
			AND a.model= #{model,jdbcType=VARCHAR}
		</if>
		<if test="announceYear != null">
			AND a.announce_year in
			<foreach collection="announceYear" index="index" item="item"
				open="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
		<if test="standardColorId != null">
			AND a.standard_color_id in
			<foreach collection="standardColorId" index="index" item="item"
				open="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
		<if test="warehouseId != null">
			AND a.warehouse_id in
			<foreach collection="warehouseId" index="index" item="item"
				open="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
		<if test="qualityStatus != null">
			AND a.quality_status in
			<foreach collection="qualityStatus" index="index" item="item"
				open="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
		<if test="lockStatus != null">
			AND a.lock_status in
			<foreach collection="lockStatus" index="index" item="item"
				open="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
		<if test="deliveryStart != null and deliveryStart !=''">
			AND g.delivery_time &gt;= #{deliveryStart,jdbcType=VARCHAR}
		</if>
		<if test="deliveryEnd != null and deliveryEnd !=''">
			AND g.delivery_time &lt;= #{deliveryEnd,jdbcType=VARCHAR}
		</if>
		<if test="storageStart != null and storageStart !=''">
			AND f.storage_time &gt;= #{storageStart,jdbcType=VARCHAR}
		</if>
		<if test="storageEnd != null and storageEnd !=''">
			AND f.storage_time &lt;= #{storageEnd,jdbcType=VARCHAR}
		</if>
		ORDER BY  a.create_time DESC,
		a.id DESC
		LIMIT
		#{pageIndex,jdbcType=INTEGER},#{pageNumber,jdbcType=INTEGER}
	</select>

	<update id="updateLockStruts">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Wed Aug 23 
			17:12:20 CST 2017. -->
		UPDATE tb_vehicle SET lock_status=#{lockStatus,jdbcType=INTEGER} WHERE
		id=#{vehicleId,jdbcType=INTEGER}
	</update>
	
	<select id="getmodelPicture" resultType="String">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Wed Aug 23 
			17:12:20 CST 2017. -->
		SELECT model_picture_path FROM tb_brand
		WHERE brand=#{brand,jdbcType=VARCHAR} AND series=#{series,jdbcType=VARCHAR} AND model=#{model,jdbcType=VARCHAR} AND announce_year = #{announceYear,jdbcType=VARCHAR}
	</select>
	
	
	<select id="getCountToTransport" resultType="java.lang.Integer">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Wed Aug 23 
			17:12:20 CST 2017. -->
		SELECT COUNT(1) FROM tb_order h
		LEFT JOIN  tb_vehicle a ON h.vehicle_id=a.id
		LEFT JOIN tb_warehouse b ON a.warehouse_id=b.id
		LEFT JOIN
		tb_storage_vehicle d ON a.id=d.id
		WHERE a.dealer_id = (SELECT g.customer_id FROM tb_user g WHERE g.id = #{userId,jdbcType=INTEGER} )
		<if test="status != null">
			AND h.status in
			<foreach collection="status" index="index" item="item"
				open="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
		<if test="vin != null and vin !=''">
			AND a.vin LIKE #{vin,jdbcType=VARCHAR}
		</if>
		<if test="orderNo != null and orderNo !=''">
			AND h.no LIKE #{orderNo,jdbcType=VARCHAR}
		</if>
		<if test="warehouseId != null">
			AND a.warehouse_id in
			<foreach collection="warehouseId" index="index" item="item"
				open="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
		<if test="orderStart != null and orderStart !=''">
			AND h.create_time &gt;= #{orderStart,jdbcType=VARCHAR}
		</if>
		<if test="orderEnd != null and orderEnd !=''">
			AND h.create_time &lt;= #{orderEnd,jdbcType=VARCHAR}
		</if>
		<if test="pickupSelfStart != null and pickupSelfStart !=''">
			AND h.pickup_self_time &gt;= #{pickupSelfStart,jdbcType=VARCHAR}
		</if>
		<if test="pickupSelfEnd != null and pickupSelfEnd !=''">
			AND h.pickup_self_time &lt;= #{pickupSelfEnd,jdbcType=VARCHAR}
		</if>
		<if test="transportType != null and transportType !=''">
			AND h.transport_type in
			<foreach collection="transportType" index="index" item="item"
				open="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
	</select>
	
	<select id="getTransportOrder" resultMap="BaseResultMap">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Wed Aug 23 
			17:12:20 CST 2017. -->
		SELECT
		a.id,a.vin,a.brand,a.series,a.model,d.dict_key,a.manufacturer_color,h.status as vehicle_status,c.name
		AS warehouseName,h.delivery_plan_id
		,a.lock_status,a.announce_year,h.no AS transportNo,h.transport_type,h.pickup_self_time,h.id as orderId
		FROM
		 tb_order h
		 LEFT JOIN tb_vehicle a ON h.vehicle_id=a.id
		LEFT JOIN
		tb_warehouse c ON a.warehouse_id = c.id
		LEFT JOIN tb_dict d ON
		a.standard_color_id = d.id
		WHERE a.dealer_id = (SELECT g.customer_id FROM tb_user g WHERE g.id = #{userId,jdbcType=INTEGER} )
		<if test="status != null">
			AND h.status in
			<foreach collection="status" index="index" item="item"
				open="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
		<if test="vin != null and vin !=''">
			AND a.vin LIKE #{vin,jdbcType=VARCHAR}
		</if>
		<if test="orderNo != null and orderNo !=''">
			AND h.no LIKE #{orderNo,jdbcType=VARCHAR}
		</if>
		<if test="warehouseId != null">
			AND a.warehouse_id in
			<foreach collection="warehouseId" index="index" item="item"
				open="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
		<if test="orderStart != null and orderStart !=''">
			AND h.create_time &gt;= #{orderStart,jdbcType=VARCHAR}
		</if>
		<if test="orderEnd != null and orderEnd !=''">
			AND h.create_time &lt;= #{orderEnd,jdbcType=VARCHAR}
		</if>
		<if test="pickupSelfStart != null and pickupSelfStart !=''">
			AND h.pickup_self_time &gt;= #{pickupSelfStart,jdbcType=VARCHAR}
		</if>
		<if test="pickupSelfEnd != null and pickupSelfEnd !=''">
			AND h.pickup_self_time &lt;= #{pickupSelfEnd,jdbcType=VARCHAR}
		</if>
		<if test="transportType != null and transportType !=''">
			AND h.transport_type in
			<foreach collection="transportType" index="index" item="item"
				open="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
		ORDER BY h.create_time DESC
		LIMIT
		#{pageIndex,jdbcType=INTEGER},#{pageNumber,jdbcType=INTEGER}
	</select>
	
	<select id="getByVinVehicle" resultMap="BaseResultMap" >
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Wed Aug 23 
			17:12:20 CST 2017. -->
		SELECT a.*,b.name AS
		warehouseName,b.contactor_mobile,c.dict_key,d.location,e.customer,f.name
		AS userName,e.create_time AS planTime FROM
		tb_vehicle a
		LEFT JOIN
		tb_warehouse b ON
		a.warehouse_id=b.id
		LEFT JOIN
		tb_dict c ON
		a.standard_color_id=c.id
		LEFT
		JOIN tb_storage_vehicle d ON
		a.id=d.id
		LEFT JOIN tb_storage_plan e ON
		d.storage_plan_id=e.id
		LEFT
		JOIN tb_user
		f ON e.create_user = f.id
		WHERE a.vin=#{vin,jdbcType=VARCHAR} AND a.dealer_id = (SELECT g.customer_id FROM tb_user g WHERE g.id = #{userId,jdbcType=INTEGER} )
		ORDER BY e.storage_time DESC LIMIT 1 
	</select>

	<select id="getBydeliveryPlanId" resultMap="BaseResultMap" parameterType="java.lang.Integer">
			<!-- WARNING - @mbggenerated This element is automatically generated by 
				MyBatis Generator, do not modify. This element was generated on Wed Aug 23 
				17:12:20 CST 2017. -->
		SELECT a.id AS orderId,a.no AS orderNo,b.id,b.vin,b.brand,b.series,b.model,b.announce_year,b.manufacturer_color,c.dict_key,a.status AS vehicle_status FROM tb_order a
		LEFT JOIN tb_vehicle b ON a.vehicle_id=b.id
		LEFT JOIN tb_dict c ON b.standard_color_id=c.id
		WHERE a.delivery_plan_id = #{deliveryId,jdbcType=INTEGER}
		order by a.id desc
	</select>
	
	<select id="getBydeliveryVehicleId" resultMap="BaseResultMap" parameterType="java.lang.Integer">
			<!-- WARNING - @mbggenerated This element is automatically generated by 
				MyBatis Generator, do not modify. This element was generated on Wed Aug 23 
				17:12:20 CST 2017. -->
		SELECT a.vin,a.brand,a.series,a.model,a.manufacturer_color,a.announce_year,b.dict_key FROM tb_vehicle a
		LEFT JOIN tb_dict b ON b.id=a.standard_color_id
		WHERE a.id = #{vehicleId,jdbcType=INTEGER}
	</select>
  <sql id="Base_Where_List" >
    <if test="vin != null and vin != ''">
        and a.vin like concat("%",#{vin},"%")
    </if>
    <if test="customer != null and customer != ''">
        and tb_storage_plan.customer = #{customer}
    </if>
    <if test="customerId != null and customerId != ''">
        and tb_storage_plan.customer_id = #{customerId}
    </if>
    <if test="warehouseName != null and warehouseName != ''">
        and tb_storage_plan.warehouse_name like concat("%",#{warehouseName},"%")
    </if>
    <if test="brand != null and brand != ''">
        and a.brand like concat("%",#{brand,jdbcType=VARCHAR},"%")
    </if>
    <if test="series != null and series != ''">
        and a.series like concat("%",#{series,jdbcType=VARCHAR},"%")
    </if>
    <if test="model != null and model != ''">
        and a.model like concat("%",#{model,jdbcType=VARCHAR},"%")
    </if>
    <if test="announceYear != null and announceYear != ''">
        and a.announce_year=#{announceYear,jdbcType=VARCHAR}
    </if>
    <if test="standardColorId != null and standardColorId != ''">
        and a.standard_color_id=#{standardColorId,jdbcType=VARCHAR}
    </if>
    <if test="vehicleStatusSearch != null and vehicleStatusSearch !=''">
    	<if test="vehicleStatusSearch == 0">
    		and a.vehicle_status in (0,1,2,3,6)
    	</if>
    	<if test="vehicleStatusSearch == 1">
    		and a.vehicle_status in (4,5,7,9)
    	</if>
    </if>
    <if test="qualityStatusSearch != null and qualityStatusSearch !=''">
        and a.quality_status = #{qualityStatusSearch,jdbcType=INTEGER}
    </if>
    <if test="lockStatusSearch != null and lockStatusSearch !=''">
        and a.lock_status = #{lockStatusSearch,jdbcType=INTEGER}
    </if>
    <if test="storageStartTime != null and storageStartTime != ''">
        and date_format(tb_storage_plan.storage_time,'%Y-%m-%d') >= #{storageStartTime}
    </if>
    <if test="storageEndTime != null and storageEndTime != ''">
        and date_format(tb_storage_plan.storage_time,'%Y-%m-%d') <![CDATA[<=]]> #{storageEndTime}
    </if>
    <if test="deliveryStartTime != null and deliveryStartTime != ''">
        and date_format(b.delivery_time,'%Y-%m-%d') >= #{deliveryStartTime}
    </if>
    <if test="deliveryEndTime != null and deliveryEndTime != ''">
        and date_format(b.delivery_time,'%Y-%m-%d') <![CDATA[<=]]> #{deliveryEndTime}
    </if>
    <if test="receivedStartTime != null and receivedStartTime != ''">
        and date_format(b.receive_time,'%Y-%m-%d') >= #{receivedStartTime}
    </if>
    <if test="receivedEndTime != null and receivedEndTime != ''">
        and date_format(b.receive_time,'%Y-%m-%d') <![CDATA[<=]]> #{receivedEndTime}
    </if>
    <if test="createUser != null and createUser != ''">
		and a.create_user = #{createUser}
    </if>
    <if test="idList !=null and idList.size>0">
		and a.warehouse_id in
		<foreach collection="idList" index="index" item="item" open="("
			separator="," close=")">
			#{item}
		</foreach>
	  </if>   
    </sql>
  <!-- 分页查询条数查询 -->
   <select id="queryStockVehicleCount" resultType="java.lang.Integer" parameterType="com.anji.allways.business.entity.VehicleEntity" >
    select 
        count(1)
    FROM
		tb_vehicle a
	INNER JOIN tb_storage_vehicle ON (
		tb_storage_vehicle.id = a.storage_vehicle_id
	)
	INNER JOIN tb_storage_plan ON (
		tb_storage_plan.id = tb_storage_vehicle.storage_plan_id
		AND tb_storage_plan.STATUS = 1
	)
	LEFT JOIN tb_order b ON (a.id = b.vehicle_id
	and b.status <![CDATA[<>]]> 6)
	LEFT JOIN tb_dict T1 ON (T1.id = a.standard_color_id)
    where 1=1
        <include refid="Base_Where_List"/>
  </select>   
   <!-- 分页查询记录 -->
   <select id="queryStockVehicles" resultMap="StockVehicleResultMap" parameterType="com.anji.allways.business.entity.VehicleEntity" >
    SELECT
		a.id,
		a.vin,
		a.brand,
		a.series,
		a.model,
		a.standard_color_id,
		tb_storage_plan.warehouse_name,
		tb_storage_plan.customer,
		tb_storage_vehicle.location,
		tb_storage_plan.storage_time,
		b.delivery_time,
		b.receive_time,
		b.operator_name,
		a.vehicle_status,
		a.lock_status,
		a.quality_status,
		T1.dict_key AS standard_color_name
	FROM
		tb_vehicle a
	INNER JOIN tb_storage_vehicle ON (
		tb_storage_vehicle.id = a.storage_vehicle_id
	)
	INNER JOIN tb_storage_plan ON (
		tb_storage_plan.id = tb_storage_vehicle.storage_plan_id
		AND tb_storage_plan.STATUS = 1
	)
	LEFT JOIN tb_order b ON (a.id = b.vehicle_id
	and b.status <![CDATA[<>]]> 6)
	LEFT JOIN tb_dict T1 ON (T1.id = a.standard_color_id)
    where 1=1
        <include refid="Base_Where_List"/>
    order by a.create_time desc,a.id desc
    <if test="dbIndex != null and dbNumber != null">
      limit #{dbIndex},#{dbNumber}
    </if>
  </select>
  
  <!-- 查询车辆订单唯一 -->
   <select id="queryOrderVehicleCount" resultType="java.lang.Integer" parameterType="java.lang.Integer" >
    SELECT COUNT(1) FROM tb_order WHERE vehicle_id =#{vehicleId,jdbcType=INTEGER} AND STATUS !=6
  </select>   
    
    <!-- 批量更新车辆状态 -->
   <update id="updateVehicleStatus"  parameterType="java.util.Map">
   		update tb_vehicle set vehicle_status = #{vehicleStatus,jdbcType=INTEGER} 
   		where 1=1
   		<if test=" list!=null and list.size >0 ">
		    and id in
   		 	<foreach collection="list" index="index" item="item" open="(" separator="," close=")">
		        #{item}
		    </foreach>
		</if>
   </update>
   
   
    <!-- 根据计划单id找到对应的所有车辆的id -->
   <select id="selectVehicleIdByDeliveryPlanId"  parameterType="java.lang.Integer" resultMap="StockVehicleResultMap">
	   SELECT
			veh.id as id
		FROM
			tb_vehicle veh
		INNER JOIN tb_order o ON veh.id = o.vehicle_id
		INNER JOIN tb_delivery_plan plan ON plan.id = o.delivery_plan_id
		WHERE
			plan.id = #{deliveryPlanId,jdbcType=INTEGER}
			AND o.status in (2,3)
	   order by veh.id desc
   </select>
   
   
    <!-- 发运编辑是根据计划单id找到对应的所有车辆的id -->
   <select id="selectVehicleIdByDeliveryPlanIdFy"  parameterType="java.lang.Integer" resultMap="StockVehicleResultMap">
	   SELECT
			veh.id id
		FROM
			tb_vehicle veh
		INNER JOIN tb_order o ON veh.id = o.vehicle_id
		INNER JOIN tb_delivery_plan plan ON plan.id = o.delivery_plan_id
		WHERE
			plan.id = #{deliveryPlanId,jdbcType=INTEGER}
   </select>
 
   
    <!-- 更新车辆状态 -->
   <update id="updateVehicleStatusById"  parameterType="java.util.Map">
   		update tb_vehicle set vehicle_status = #{vehicleStatus,jdbcType=INTEGER} where id = #{id,jdbcType=INTEGER}
   </update>
   
   
    <!-- 更新车辆质损状态 -->
   <update id="updateQualityStatusById"  parameterType="java.util.Map">
   		update tb_vehicle set quality_status = #{qualityStatus,jdbcType=INTEGER} 
   		where 1=1
   		<if test=" id!=null and id !=''  ">
		    and id = #{id,jdbcType=INTEGER}
		</if>
   </update>
   
   
    <!-- 查询车辆订单唯一 -->
   <select id="queryOrderIncomeVehicleStatus" resultType="java.lang.Integer" parameterType="java.lang.Integer" >
    SELECT
	COUNT(1) FROM tb_order b
	LEFT JOIN tb_vehicle d ON b.vehicle_id=d.id
	WHERE b.delivery_plan_id =#{deliveryId,jdbcType=INTEGER} AND (b.status = 9 OR b.status = 4 OR b.status = 7 OR b.status = 2)
  </select>
  
  <!-- 查询车辆订单唯一 -->
   <select id="queryDriverIncomeVehicleStatus" resultType="java.lang.Integer" parameterType="java.lang.Integer" >
    SELECT
	COUNT(1) FROM tb_order b
	LEFT JOIN tb_vehicle d ON b.vehicle_id=d.id
	WHERE b.delivery_plan_id =#{deliveryId,jdbcType=INTEGER} AND (b.status = 7 OR b.status = 3)
  </select>
   
   <select id="countInVehicle" resultType="java.lang.Integer" parameterType="java.util.Map">
    SELECT
    COUNT(*) FROM tb_vehicle
   	where warehouse_id =#{warehouseId,jdbcType=INTEGER} AND dealer_id =#{customerId,jdbcType=INTEGER}
   	AND (vehicle_status = 0 OR vehicle_status = 1)
   </select>
   
    <!-- 查询导出库存记录 -->
   <select id="queryStorageRecordsForExportData" resultType="java.util.LinkedHashMap" parameterType="java.util.Map" >
    select 
        IFNULL(a.vin,'') as VIN码, 
        IFNULL(a.brand,'') as 品牌, 
        IFNULL(a.series,'') as 车系, 
        IFNULL(a.model,'') as 车型, 
        IFNULL(T1.dict_key,'') as 颜色,
        IFNULL(tb_storage_plan.warehouse_name,'') as 仓库, 
        IFNULL(tb_storage_plan.customer,'') as 客户名称, 
        IFNULL(tb_storage_vehicle.location,'') as 库位号, 
        IFNULL(date_format(tb_storage_plan.storage_time,'%y-%m-%d %h:%i:%s'),'') as 入库时间,
        IFNULL(date_format(b.delivery_time,'%y-%m-%d %h:%i:%s'),'') as 出库时间,
        IFNULL(date_format(b.receive_time,'%y-%m-%d %h:%i:%s'),'') as 收车时间,
        case
			when a.vehicle_status = 0 or a.vehicle_status = 1 or a.vehicle_status = 2 or a.vehicle_status = 3 or a.vehicle_status = 6 then
				'在库'
			ELSE
				'出库'
			end as 车辆状态,
		case
			when a.lock_status = 0 then
				'未锁定'
			when a.lock_status = 1 then
				'锁定'
			ELSE
				''
			end as 锁定状态,
		case
			when a.quality_status = 0 then
				'正常'
			when a.quality_status = 1 then
				'质损'
			ELSE
				''
			end as 质量状态
    from tb_vehicle a
    INNER JOIN tb_storage_vehicle ON (
	tb_storage_vehicle.id = a.storage_vehicle_id
	)
	INNER JOIN tb_storage_plan ON (
		tb_storage_plan.id = tb_storage_vehicle.storage_plan_id
	)
	LEFT JOIN tb_order b ON (a.id = b.vehicle_id
	and b.status <![CDATA[<>]]> 6)
	LEFT JOIN tb_dict T1 ON (T1.id = a.standard_color_id)
    where 1=1
        <include refid="Base_Where_List"/>
    order by a.create_time desc,a.id desc
  </select>
  
  <select id="seleByWareHouseIdToStorageTime" resultType="java.lang.String" parameterType="java.util.Map">
    SELECT storage_time AS days FROM tb_vehicle a
	LEFT JOIN tb_storage_vehicle b ON a.storage_vehicle_id = b.id
	LEFT JOIN tb_storage_plan c ON b.storage_plan_id = c.id
	WHERE a.warehouse_id = #{warehouseId,jdbcType=INTEGER} AND a.vehicle_status IN (0,1,2,3)
   </select>
   
   <update id="updateByPrimaryKeyById" parameterType="com.anji.allways.business.entity.VehicleEntity">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Wed Aug 23 
			17:12:20 CST 2017. -->
		update tb_vehicle
		set 
		brand = #{brand,jdbcType=VARCHAR},
		series =
		#{series,jdbcType=VARCHAR},
		model = #{model,jdbcType=VARCHAR},
		announce_year = #{announceYear,jdbcType=VARCHAR},
		standard_color_id =
		#{standardColorId,jdbcType=INTEGER},
		manufacturer_color =
		#{manufacturerColor,jdbcType=VARCHAR},
		license_number = #{licenseNumber,jdbcType=VARCHAR},
		registration_number =
		#{registrationNumber,jdbcType=VARCHAR},
		comment =
		#{comment,jdbcType=VARCHAR},
		update_user =
		#{updateUser,jdbcType=INTEGER},
		update_time =
		#{updateTime,jdbcType=TIMESTAMP}
		where id = #{id,jdbcType=INTEGER}
	</update>
	
	<update id="updatePathById"  parameterType="java.util.Map">
   		update tb_vehicle set picture_path = #{picturePath,jdbcType=VARCHAR} 
   		where id = #{vehicleId,jdbcType=INTEGER}
   </update>
   
   <select id="selectByIdToHomeCount" resultType="java.lang.Integer" parameterType="java.util.Map">
    SELECT COUNT(*) FROM tb_vehicle
	WHERE dealer_id =(SELECT customer_id FROM tb_user WHERE id=#{userId,jdbcType=INTEGER})
	<if test=" list!=null and list.size >0 ">
	    AND vehicle_status in
  		<foreach collection="list" index="index" item="item" open="(" separator="," close=")">
	        #{item} 
	    </foreach>
	</if>
   </select>

   <select id="selectStorageVehicleCountByCustomer" resultType="java.lang.Integer" parameterType="java.util.Map">
    SELECT COUNT(*) FROM tb_storage_vehicle a
	LEFT JOIN tb_storage_plan b ON b.id = a.storage_plan_id
	WHERE DATE_FORMAT(b.create_time,"%Y%m%d") = DATE_FORMAT(NOW(),"%Y%m%d")
	AND b.customer_id = (SELECT customer_id FROM tb_user WHERE id=#{userId,jdbcType=INTEGER})
   </select>

	<select id="selectOrderCountByCustomer" resultType="java.lang.Integer" parameterType="java.util.Map">
    SELECT COUNT(*) FROM tb_order
	WHERE customer_id = (SELECT customer_id FROM tb_user WHERE id=#{userId,jdbcType=INTEGER})
	AND DATE_FORMAT(create_time,"%Y%m%d") = DATE_FORMAT(NOW(),"%Y%m%d")
   </select>

   <select id="selectWarehouseVehicleCountByCustomer" resultType="java.util.Map" parameterType="java.util.Map">
    SELECT a.id, a.name,MAX(b.space_amount) AS cspaceAmount,MAX(a.space_amount) AS dspaceAmount FROM tb_warehouse a
	LEFT JOIN tb_warehouse_link_customer b ON a.id=b.warehouse_id
	WHERE b.customer_id = (SELECT customer_id FROM tb_user WHERE id=#{customerId,jdbcType=INTEGER})
	GROUP BY a.name,a.id
   </select>

   <select id="selectVehicleCountByWarehouseAndCustomer" resultType="java.lang.Integer" parameterType="java.util.Map">
    SELECT COUNT(id) FROM tb_vehicle 
	WHERE warehouse_id =#{warehouseId,jdbcType=INTEGER} AND dealer_id = (SELECT customer_id FROM tb_user WHERE id=#{customerId,jdbcType=INTEGER})
	AND vehicle_status IN (0,1,2,3)
   </select>
   
   <select id="selectStorageVehicleCountByWarehouse" resultType="java.lang.Integer" parameterType="java.util.Map">
    SELECT COUNT(*) FROM tb_storage_vehicle a
	LEFT JOIN tb_storage_plan b ON b.id = a.storage_plan_id
	WHERE DATE_FORMAT(b.create_time,"%Y%m%d") = DATE_FORMAT(NOW(),"%Y%m%d")
	<if test=" ids!=null and ids.size >0 ">
	    AND warehouse_id in
  		<foreach collection="ids" index="index" item="item" open="(" separator="," close=")">
	        #{item} 
	    </foreach>
	</if>
   </select>
   
   <select id="selectOrderCountByWarehouse" resultType="java.lang.Integer" parameterType="java.util.Map">
    SELECT COUNT(*) FROM tb_order
	WHERE 1=1 
	<if test=" ids!=null and ids.size >0 ">
	    AND warehouse_id in
  		<foreach collection="ids" index="index" item="item" open="(" separator="," close=")">
	        #{item} 
	    </foreach>
	</if>
	AND DATE_FORMAT(create_time,"%Y%m%d") = DATE_FORMAT(NOW(),"%Y%m%d")
   </select>
   
   <select id="selectOutStorageVehicleCountByWarehouse" resultType="java.lang.Integer" parameterType="java.util.Map">
    SELECT COUNT(*) FROM tb_vehicle a
	LEFT JOIN tb_warehouse b ON a.warehouse_id = b.id
	LEFT JOIN tb_user c ON b.id = c.customer_id
	WHERE c.id=#{userId,jdbcType=INTEGER} AND a.vehicle_status IN (4,9)
   </select>
   
   <select id="selectIncomeVehicleCountByWarehouse" resultType="java.lang.Integer" parameterType="java.util.Map">
    SELECT COUNT(*) FROM tb_vehicle a
	LEFT JOIN tb_warehouse b ON a.warehouse_id = b.id
	LEFT JOIN tb_user c ON b.id = c.customer_id
	WHERE c.id=#{userId,jdbcType=INTEGER} AND a.vehicle_status IN (5)
   </select>

   <select id="selectStockByCustomer" resultType="java.util.Map" parameterType="java.util.Map">
    SELECT COUNT(d.id) AS storageAmount,MAX(c.name) AS customerName,MAX(a.space_amount) AS spaceAmount FROM tb_warehouse a
	RIGHT JOIN tb_warehouse_link_customer b ON b.warehouse_id = a.`id`
	RIGHT JOIN tb_customer c ON c.id=b.customer_id
	LEFT JOIN tb_vehicle d ON c.id = d.dealer_id
	WHERE a.id=(SELECT customer_id FROM tb_user WHERE id=#{userId,jdbcType=INTEGER})
	GROUP BY c.id
   </select>

   <select id="selectSpaceAmountByCustomer" resultType="java.lang.String" parameterType="java.util.Map">
    SELECT SUM(space_amount) AS spaceAmount FROM tb_warehouse_link_customer
	WHERE customer_id = (SELECT customer_id FROM tb_user WHERE id=#{userId,jdbcType=INTEGER})
   </select>

   <select id="selectSpaceAmountByCustomerAndWarehouse" resultType="java.lang.String" parameterType="java.util.Map">
    SELECT space_amount FROM tb_warehouse_link_customer
	WHERE customer_id = (SELECT customer_id FROM tb_user WHERE id=#{customerId,jdbcType=INTEGER}) AND warehouse_id =#{warehouseId,jdbcType=INTEGER}
   </select>

   <select id="selectStorageAmountByCustomerAndWarehouse" resultType="java.lang.Integer" parameterType="java.util.Map">
    SELECT COUNT(id) AS id FROM tb_vehicle
	WHERE warehouse_id = #{warehouseId,jdbcType=INTEGER} AND dealer_id = (SELECT customer_id FROM tb_user WHERE id = #{customerId,jdbcType=INTEGER})
	AND vehicle_status IN (0,1,2,3)
   </select>
   
   <select id="selectStockByGroupId" resultType="java.lang.Integer" parameterType="java.util.Map">
    SELECT COUNT(*) FROM tb_vehicle 
	WHERE dealer_id IN(
	SELECT id FROM tb_customer a
	WHERE a.group_id = (SELECT customer_id FROM tb_user WHERE id=#{customerId,jdbcType=INTEGER}))
	<if test=" list!=null and list.size >0 ">
	    AND vehicle_status in
  		<foreach collection="list" index="index" item="item" open="(" separator="," close=")">
	        #{item}
	    </foreach>
	</if>
   </select>

   <select id="selectSpaceAmountByGroupId" resultType="java.lang.String" parameterType="java.util.Map">
    SELECT SUM(space_amount) AS spaceAmount FROM tb_warehouse_link_customer
	WHERE customer_id IN (
	SELECT id FROM tb_customer a
	WHERE a.group_id = (SELECT customer_id FROM tb_user WHERE id=#{customerId,jdbcType=INTEGER}))
   </select>
   
   <select id="selectStorageVehicleCountByGroup" resultType="java.lang.Integer" parameterType="java.util.Map">
    SELECT COUNT(*) FROM tb_storage_vehicle a
	LEFT JOIN tb_storage_plan b ON b.id = a.storage_plan_id
	WHERE DATE_FORMAT(b.create_time,"%Y%m%d") = DATE_FORMAT(NOW(),"%Y%m%d")
	AND b.customer_id IN(
	SELECT id FROM tb_customer a
	WHERE a.group_id = (SELECT customer_id FROM tb_user WHERE id=#{customerId,jdbcType=INTEGER}))
   </select>
   
   <select id="selectOrderCountByGroup" resultType="java.lang.Integer" parameterType="java.util.Map">
    SELECT COUNT(*) FROM tb_order
	WHERE customer_id IN(
	SELECT id FROM tb_customer a
	WHERE a.group_id = (SELECT customer_id FROM tb_user WHERE id=#{customerId,jdbcType=INTEGER}))
	AND DATE_FORMAT(create_time,"%Y%m%d") = DATE_FORMAT(NOW(),"%Y%m%d")
   </select>

   <select id="selectNotIncomeVehicleByWeb" resultType="java.lang.Integer" parameterType="java.util.Map">
    SELECT COUNT(*) FROM tb_vehicle a   
	LEFT JOIN tb_order b ON a.id = b.vehicle_id
	WHERE 1=1
	<if test=" ids!=null and ids.size >0 ">
	    AND a.warehouse_id in
  		<foreach collection="ids" index="index" item="item" open="(" separator="," close=")">
	        #{item} 
	    </foreach>
	</if> 
	<if test=" list!=null and list.size >0 ">
	    AND vehicle_status in
  		<foreach collection="list" index="index" item="item" open="(" separator="," close=")">
	        #{item}
	    </foreach>
	</if>   
	AND DATE_FORMAT(b.receive_time,"%Y%m%d") = DATE_FORMAT(NOW(),"%Y%m%d")
   </select>
   
   <select id="selectByIdToHomeCountByWeb" resultType="java.lang.Integer" parameterType="java.util.Map">
    SELECT COUNT(*) FROM tb_vehicle
	WHERE 1=1
	<if test=" ids!=null and ids.size >0 ">
	    AND warehouse_id in
  		<foreach collection="ids" index="index" item="item" open="(" separator="," close=")">
	        #{item} 
	    </foreach>
	</if>
	<if test=" list!=null and list.size >0 ">
	    AND vehicle_status in
  		<foreach collection="list" index="index" item="item" open="(" separator="," close=")">
	        #{item} 
	    </foreach>
	</if>
   </select>
   
   <select id="selectSpaceAmountByWarehouse" resultType="java.lang.String" parameterType="java.util.Map">
    SELECT sum(space_amount) FROM tb_warehouse
	WHERE 1=1
	<if test=" ids!=null and ids.size >0 ">
	    AND id in
  		<foreach collection="ids" index="index" item="item" open="(" separator="," close=")">
	        #{item} 
	    </foreach>
	</if>
   </select>

   <select id="selectCustomerByWarehouseWeb" resultType="java.util.Map" parameterType="java.util.Map">
    SELECT DISTINCT c.name AS customerName,c.id FROM tb_warehouse a
	INNER JOIN tb_warehouse_link_customer b ON a.id=b.warehouse_id
	INNER JOIN tb_customer c ON b.customer_id = c.id
	WHERE 1=1
	<if test=" ids!=null and ids.size >0 ">
	    AND a.id in
  		<foreach collection="ids" index="index" item="item" open="(" separator="," close=")">
	        #{item} 
	    </foreach>
	</if>
   </select>

   <select id="selectStorageAmountByCustomerAndWarehouseWeb" resultType="java.lang.Integer" parameterType="java.util.Map">
    SELECT COUNT(id) AS id FROM tb_vehicle
	WHERE warehouse_id = #{warehouseId,jdbcType=INTEGER} AND dealer_id = #{customerId,jdbcType=INTEGER}
	AND vehicle_status IN (0,1,2,3)
   </select>

</mapper>