<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.anji.allways.business.mapper.OrderEntityMapper" >
  <resultMap id="BaseResultMap" type="com.anji.allways.business.entity.OrderEntity" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Aug 23 17:12:20 CST 2017.
    -->
    <id column="id" property="id" jdbcType="INTEGER" />
    <result column="no" property="no" jdbcType="VARCHAR" />
    <result column="vin" property="vin" jdbcType="VARCHAR" />
    <result column="vehicle_id" property="vehicleId" jdbcType="INTEGER" />
    <result column="destination" property="destination" jdbcType="VARCHAR" />
    <result column="warehouse_name" property="warehouseName" jdbcType="VARCHAR" />
    <result column="warehouse_id" property="warehouseId" jdbcType="INTEGER" />
    <result column="customer" property="customer" jdbcType="VARCHAR" />
    <result column="customer_id" property="customerId" jdbcType="INTEGER" />
    <result column="location" property="location" jdbcType="VARCHAR" />
    <result column="create_time" property="createTime" jdbcType="TIMESTAMP" />
    <result column="receive_time" property="receiveTime" jdbcType="TIMESTAMP" />
    <result column="storage_plan_id" property="storagePlanId" jdbcType="INTEGER" />
    <result column="delivery_plan_id" property="deliveryPlanId" jdbcType="INTEGER" />
    <result column="storage_time" property="storageTime" jdbcType="TIMESTAMP" />
    <result column="operator_name" property="operatorName" jdbcType="VARCHAR" />
    <result column="ship_no" property="shipNo" jdbcType="VARCHAR" />
    <result column="consignee_id" property="consigneeId" jdbcType="INTEGER" />
    <result column="pickup_self_time" property="pickupSelfTime" jdbcType="TIMESTAMP" />
    <result column="delivery_time" property="deliveryTime" jdbcType="TIMESTAMP" />
    <result column="transport_type" property="transportType" jdbcType="VARCHAR" />
    <result column="status" property="status" jdbcType="INTEGER" />
    <result column="is_void" property="isVoid" jdbcType="INTEGER" />
    <result column="create_user" property="createUser" jdbcType="INTEGER" />
    <result column="update_user" property="updateUser" jdbcType="INTEGER" />
    <result column="update_time" property="updateTime" jdbcType="TIMESTAMP" />
    <result column="consignee_name" property="consigneeName" jdbcType="VARCHAR" />
    <result column="consignee_mobile" property="consigneeMobile" jdbcType="VARCHAR" />
    <result column="reserved" property="reserved" jdbcType="VARCHAR" />
  </resultMap>

   <resultMap id="BaseResultMapZt" type="com.anji.allways.business.vo.OrderVO" >
   		<id column="id" property="id" jdbcType="INTEGER" />
   		<result column="no" property="no" jdbcType="VARCHAR" />
   		<result column="warehouse_id" property="warehouseId" jdbcType="INTEGER" />
    	<result column="vin" property="vin" jdbcType="VARCHAR" />
    	<result column="create_time" property="createTime" jdbcType="TIMESTAMP" />
   		<result column="pickup_self_time" property="pickupSelfTime" jdbcType="TIMESTAMP" />
   		<result column="customer" property="customer" jdbcType="VARCHAR" />
   		<result column="warehouse_name" property="warehouseName" jdbcType="VARCHAR" />
   		<result column="order_num" property="orderNum" jdbcType="INTEGER" />
   		
   </resultMap>
   
   
   <resultMap id="homePage" type="com.anji.allways.business.vo.HomePageVO">
		<result column="ZKS" property="inbound" jdbcType="INTEGER" />
		<result column="DDD" property="dispatch" jdbcType="INTEGER" />
		<result column="DCK" property="outbound" jdbcType="INTEGER" />
		<result column="DZT" property="pickUp" jdbcType="INTEGER" />
	</resultMap>
   
  
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Aug 23 17:12:20 CST 2017.
    -->
    id, no, vin, vehicle_id, destination, warehouse_name, warehouse_id, customer, customer_id, location, 
    create_time, receive_time, storage_plan_id, delivery_plan_id, storage_time, operator_name, 
    ship_no, consignee_id, pickup_self_time, delivery_time, transport_type, status, is_void, 
    create_user, update_user, update_time, reserved
  </sql>
  
  
  <!-- 发运运输单查询条件 -->
  <sql id="Base_Where_List_fy" >
 	  <if test="no != null and no != ''" >
     	   and no like concat("%",#{no,jdbcType=VARCHAR},"%")
   	  </if>
      <if test="vin != null and vin !='' " >
       	   and vin like  concat("%",#{vin,jdbcType=VARCHAR},"%")
      </if>
      <if test="customer != null and customer !='' " >
           and customer like concat("%",#{customer},"%")
      </if>
      <if test="createTimeStart != null and createTimeStart != '' " >
      	   and date_format(create_time,'%Y-%m-%d') <![CDATA[>=]]> #{createTimeStart}
      </if>
      <if test="createTimeEnd != null and createTimeEnd != '' " >
           and date_format(create_time,'%Y-%m-%d') <![CDATA[<=]]> #{createTimeEnd}
      </if>
      <if test="customerId != null and customerId != '' " >
           and customer_id = #{customerId}
      </if>
       <if test="destination != null and destination != '' " >
           and destination = #{destination}
      </if>
      <if test="consigneeId != null and consigneeId != '' " >
           and consignee_id = #{consigneeId}
      </if>
      <!-- 过滤掉加入的运单记录 -->
      <if test=" list!=null and list.size >0 ">
      	  and id not in 
		    <foreach collection="list" index="index" item="item" open="(" separator="," close=")">
		        #{item}
		    </foreach>
      </if>
      <if test="warehouseId!=null and warehouseId !='' ">
	  		and warehouse_id = #{warehouseId,jdbcType=INTEGER}
	  </if>
      <!-- 管理员登录查询条件 -->
      <if test="idList !=null and idList.size>0">
			and warehouse_id in
			<foreach collection="idList" index="index" item="item" open="("
			separator="," close=")">
			#{item}
		</foreach>
		</if>
	  <!-- 普通用户登录查询条件 -->
	  <if test="createUser != null and createUser != ''">
			and create_user = #{createUser,jdbcType=INTEGER}
	  </if>
      AND status = 1
      AND transport_type = '发运'
      AND is_void = 0
   </sql>
   
   <!-- 自提运输单查询条件 -->
  <sql id="Base_Where_List_zt" >
 	  <if test="customer != null and customer != null">
			AND customer LIKE concat("%",#{customer},"%")
	  </if>
	  <if test="pickupSelfTimeStart != null and pickupSelfTimeStart != '' ">
			AND date_format(pickup_self_time,'%Y-%m-%d') <![CDATA[>=]]> #{pickupSelfTimeStart}
	  </if>
	  <if test="pickupSelfTimeEnd != null and pickupSelfTimeEnd != '' ">
			AND date_format(pickup_self_time,'%Y-%m-%d') <![CDATA[<=]]> #{pickupSelfTimeEnd}
	  </if>
	  <!-- 管理员登录查询条件 -->
      <if test="idList !=null and idList.size>0">
			and warehouse_id in
			<foreach collection="idList" index="index" item="item" open="("
			separator="," close=")">
			#{item}
		</foreach>
		</if>
	  <!-- 普通用户登录查询条件 -->
	  <if test="createUser != null and createUser != ''">
			and create_user = #{createUser,jdbcType=INTEGER}
	  </if>
	  <if test="warehouseId!=null and warehouseId !='' ">
	  		and warehouse_id = #{warehouseId,jdbcType=INTEGER}
	  </if>
	  AND status = 1
	  AND is_void = 0
	  AND transport_type = '自提'
      
   </sql>
   
    <!-- 自提运输单查询条件 -->
  <sql id="Base_Where_List_zt_child" >
 	  <if test="customer != null and customer != null">
			AND customer LIKE concat("%",#{customer},"%")
	  </if>
	  <if test="pickupSelfTime != null">
			AND date_format(pickup_self_time,'%Y-%m-%d %H:%i:%S') = #{pickupSelfTime}
	  </if>
	<!--    <if test="consigneeId != null and consigneeId != ''">
			and consignee_id = #{consigneeId,jdbcType=INTEGER}
	  </if> -->
	  <!-- 普通用户登录查询条件 -->
	  <if test="createUser != null and createUser != ''">
			and create_user = #{createUser,jdbcType=INTEGER}
	  </if>
	  <if test="warehouseId !=null and warehouseId !='' ">
	  		and warehouse_id = #{warehouseId,jdbcType=INTEGER}
	  </if>
	  AND status = 1
	  AND is_void = 0
	  AND transport_type = '自提'
      
   </sql>
   
   <!-- 运输单管理查询条件 -->
  <sql id="Base_Where_List_Filters" >
 	  <if test="no != null and no != ''">
			AND tb_order.no LIKE concat("%",#{no},"%")
	  </if>
 	  <if test="shipNo != null and shipNo != ''">
			AND tb_delivery_plan.ship_no LIKE concat("%",#{shipNo},"%")
	  </if>
 	  <if test="vin != null and vin != ''">
			AND tb_order.vin LIKE concat("%",#{vin},"%")
	  </if>
	  <if test="customerId != null and customerId != ''">
			AND tb_order.customer_id = #{customerId}
	  </if>
 	  <if test="customer != null and customer != ''">
			AND tb_order.customer = #{customer}
	  </if>
	  <if test="createTimeStart != null and createTimeStart != ''">
			AND date_format(tb_order.create_time,'%Y-%m-%d') <![CDATA[>=]]> #{createTimeStart}
	  </if>
	  <if test="createTimeEnd != null and createTimeEnd != ''">
			AND date_format(tb_order.create_time,'%Y-%m-%d') <![CDATA[<=]]> #{createTimeEnd}
	  </if>
	  <if test="deliveryTimeStart != null and deliveryTimeStart != ''">
			AND date_format(tb_order.delivery_time,'%Y-%m-%d') <![CDATA[>=]]> #{deliveryTimeStart}
	  </if>
	  <if test="deliveryTimeEnd != null and deliveryTimeEnd != ''">
			AND date_format(tb_order.delivery_time,'%Y-%m-%d') <![CDATA[<=]]> #{deliveryTimeEnd}
	  </if>
	  <if test="pickupSelfTimeStart != null and pickupSelfTimeStart != ''">
			AND date_format(tb_order.pickup_self_time,'%Y-%m-%d') <![CDATA[>=]]> #{pickupSelfTimeStart}
	  </if>
	  <if test="pickupSelfTimeEnd != null and pickupSelfTimeEnd != ''">
			AND date_format(tb_order.pickup_self_time,'%Y-%m-%d') <![CDATA[<=]]> #{pickupSelfTimeEnd}
	  </if>
      <if test="status != null and status != 0" >
       	   <if test="status == 4">
    		 and tb_order.status in (4,7,9)
	       </if>
	       <if test="status != 4">
	    	 and tb_order.status = #{status,jdbcType=INTEGER}
	       </if>
      </if>
      <if test="createUser != null and createUser != ''">
		and tb_order.create_user = #{createUser}
	  </if>
	  <if test="idList !=null and idList.size>0">
		and tb_order.warehouse_id in
		<foreach collection="idList" index="index" item="item" open="("
			separator="," close=")">
			#{item}
		</foreach>
	  </if>      
   </sql>
  
  <!-- 分页查询条数查询 -->
   <select id="queryOrderByFilersCount" resultType="java.lang.Integer" parameterType="com.anji.allways.business.entity.OrderEntity" >
    select 
        count(1)
    from tb_order 
    left join tb_delivery_plan on
    (tb_delivery_plan.id=tb_order.delivery_plan_id)
    where 1=1
        <include refid="Base_Where_List_Filters"/>
  </select>   
   <!-- 分页查询记录 -->
   <select id="queryOrderByFilers" resultMap="BaseResultMap" parameterType="com.anji.allways.business.entity.OrderEntity" >
    select 
    tb_order.no,
    tb_order.create_time,
    tb_order.vin,
    tb_delivery_plan.ship_no,
    tb_order.customer,
    tb_order.pickup_self_time,
    tb_order.delivery_time,
    tb_order.location,
    tb_order.status,
    tb_order.transport_type
    from tb_order 
    left join tb_delivery_plan on
    (tb_delivery_plan.id=tb_order.delivery_plan_id)
    where 1=1
        <include refid="Base_Where_List_Filters"/>
    order by tb_order.id desc
    <if test="dbIndex != null and dbNumber != null">
      limit #{dbIndex},#{dbNumber}
    </if>
  </select>
  
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Aug 23 17:12:20 CST 2017.
    -->
    select 
    <include refid="Base_Column_List" />
    from tb_order
    where id = #{id,jdbcType=INTEGER}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Aug 23 17:12:20 CST 2017.
    -->
    delete from tb_order
    where id = #{id,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="com.anji.allways.business.entity.OrderEntity" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Aug 23 17:12:20 CST 2017.
    -->
    insert into tb_order (id, no, vin, vehicle_id,
      destination, warehouse_name, warehouse_id, 
      customer, customer_id, location, 
      create_time, receive_time, storage_plan_id, 
      delivery_plan_id, storage_time, operator_name, 
      ship_no, consignee_id, pickup_self_time, 
      delivery_time, transport_type, status, 
      is_void, create_user, update_user, 
      update_time, reserved)
    values (#{id,jdbcType=INTEGER}, #{no,jdbcType=VARCHAR}, #{vin,jdbcType=VARCHAR}, #{vehicleId,jdbcType=INTEGER},
      #{destination,jdbcType=VARCHAR}, #{warehouseName,jdbcType=VARCHAR}, #{warehouseId,jdbcType=INTEGER}, 
      #{customer,jdbcType=VARCHAR}, #{customerId,jdbcType=INTEGER}, #{location,jdbcType=VARCHAR}, 
      #{createTime,jdbcType=TIMESTAMP}, #{receiveTime,jdbcType=TIMESTAMP}, #{storagePlanId,jdbcType=INTEGER}, 
      #{deliveryPlanId,jdbcType=INTEGER}, #{storageTime,jdbcType=TIMESTAMP}, #{operatorName,jdbcType=VARCHAR}, 
      #{shipNo,jdbcType=VARCHAR}, #{consigneeId,jdbcType=INTEGER}, #{pickupSelfTime,jdbcType=TIMESTAMP}, 
      #{deliveryTime,jdbcType=TIMESTAMP}, #{transportType,jdbcType=VARCHAR}, #{status,jdbcType=INTEGER}, 
      #{isVoid,jdbcType=INTEGER}, #{createUser,jdbcType=INTEGER}, #{updateUser,jdbcType=INTEGER}, 
      #{updateTime,jdbcType=TIMESTAMP}, #{reserved,jdbcType=VARCHAR})
  </insert>
  <insert id="insertSelective" parameterType="com.anji.allways.business.entity.OrderEntity">
    insert into tb_order
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        id,
      </if>
      <if test="no != null" >
        no,
      </if>
      <if test="vin != null" >
        vin,
      </if>
      <if test="vehicleId != null" >
        vehicle_id,
      </if>
      <if test="destination != null" >
        destination,
      </if>
      <if test="warehouseName != null" >
        warehouse_name,
      </if>
      <if test="warehouseId != null" >
        warehouse_id,
      </if>
      <if test="customer != null" >
        customer,
      </if>
      <if test="customerId != null" >
        customer_id,
      </if>
      <if test="location != null" >
        location,
      </if>
      <if test="createTime != null" >
        create_time,
      </if>
      <if test="receiveTime != null" >
        receive_time,
      </if>
      <if test="storagePlanId != null" >
        storage_plan_id,
      </if>
      <if test="deliveryPlanId != null" >
        delivery_plan_id,
      </if>
      <if test="storageTime != null" >
        storage_time,
      </if>
      <if test="operatorName != null" >
        operator_name,
      </if>
      <if test="shipNo != null" >
        ship_no,
      </if>
      <if test="consigneeId != null" >
        consignee_id,
      </if>
      <if test="pickupSelfTime != null" >
        pickup_self_time,
      </if>
      <if test="deliveryTime != null" >
        delivery_time,
      </if>
      <if test="transportType != null" >
        transport_type,
      </if>
      <if test="status != null" >
        status,
      </if>
      <if test="isVoid != null" >
        is_void,
      </if>
      <if test="createUser != null" >
        create_user,
      </if>
      <if test="updateUser != null" >
        update_user,
      </if>
      <if test="updateTime != null" >
        update_time,
      </if>
      <if test="reserved != null" >
        reserved,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        #{id,jdbcType=INTEGER},
      </if>
      <if test="no != null" >
        #{no,jdbcType=VARCHAR},
      </if>
      <if test="vin != null" >
        #{vin,jdbcType=VARCHAR},
      </if>
      <if test="vehicleId != null" >
         #{vehicleId,jdbcType=VARCHAR},
      </if>
      <if test="destination != null" >
        #{destination,jdbcType=VARCHAR},
      </if>
      <if test="warehouseName != null" >
        #{warehouseName,jdbcType=VARCHAR},
      </if>
      <if test="warehouseId != null" >
        #{warehouseId,jdbcType=INTEGER},
      </if>
      <if test="customer != null" >
        #{customer,jdbcType=VARCHAR},
      </if>
      <if test="customerId != null" >
        #{customerId,jdbcType=INTEGER},
      </if>
      <if test="location != null" >
        #{location,jdbcType=VARCHAR},
      </if>
      <if test="createTime != null" >
        #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="receiveTime != null" >
        #{receiveTime,jdbcType=TIMESTAMP},
      </if>
      <if test="storagePlanId != null" >
        #{storagePlanId,jdbcType=INTEGER},
      </if>
      <if test="deliveryPlanId != null" >
        #{deliveryPlanId,jdbcType=INTEGER},
      </if>
      <if test="storageTime != null" >
        #{storageTime,jdbcType=TIMESTAMP},
      </if>
      <if test="operatorName != null" >
        #{operatorName,jdbcType=VARCHAR},
      </if>
      <if test="shipNo != null" >
        #{shipNo,jdbcType=VARCHAR},
      </if>
      <if test="consigneeId != null" >
        #{consigneeId,jdbcType=INTEGER},
      </if>
      <if test="pickupSelfTime != null" >
        #{pickupSelfTime,jdbcType=TIMESTAMP},
      </if>
      <if test="deliveryTime != null" >
        #{deliveryTime,jdbcType=TIMESTAMP},
      </if>
      <if test="transportType != null" >
        #{transportType,jdbcType=VARCHAR},
      </if>
      <if test="status != null" >
        #{status,jdbcType=INTEGER},
      </if>
      <if test="isVoid != null" >
        #{isVoid,jdbcType=INTEGER},
      </if>
      <if test="createUser != null" >
        #{createUser,jdbcType=INTEGER},
      </if>
      <if test="updateUser != null" >
        #{updateUser,jdbcType=INTEGER},
      </if>
      <if test="updateTime != null" >
        #{updateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="reserved != null" >
        #{reserved,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.anji.allways.business.entity.OrderEntity" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Aug 23 17:12:20 CST 2017.
    -->
    update tb_order
    <set >
      <if test="no != null" >
        no = #{no,jdbcType=VARCHAR},
      </if>
      <if test="vin != null" >
        vin = #{vin,jdbcType=VARCHAR},
      </if>
      <if test="vehicleId != null" >
        vehicle_id = #{vehicleId,jdbcType=INTEGER},
      </if>
      <if test="destination != null" >
        destination = #{destination,jdbcType=VARCHAR},
      </if>
      <if test="warehouseName != null" >
        warehouse_name = #{warehouseName,jdbcType=VARCHAR},
      </if>
      <if test="warehouseId != null" >
        warehouse_id = #{warehouseId,jdbcType=INTEGER},
      </if>
      <if test="customer != null" >
        customer = #{customer,jdbcType=VARCHAR},
      </if>
      <if test="customerId != null" >
        customer_id = #{customerId,jdbcType=INTEGER},
      </if>
      <if test="location != null" >
        location = #{location,jdbcType=VARCHAR},
      </if>
      <if test="createTime != null" >
        create_time = #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="receiveTime != null" >
        receive_time = #{receiveTime,jdbcType=TIMESTAMP},
      </if>
      <if test="storagePlanId != null" >
        storage_plan_id = #{storagePlanId,jdbcType=INTEGER},
      </if>
      <if test="deliveryPlanId != null" >
        delivery_plan_id = #{deliveryPlanId,jdbcType=INTEGER},
      </if>
      <if test="storageTime != null" >
        storage_time = #{storageTime,jdbcType=TIMESTAMP},
      </if>
      <if test="operatorName != null" >
        operator_name = #{operatorName,jdbcType=VARCHAR},
      </if>
      <if test="shipNo != null" >
        ship_no = #{shipNo,jdbcType=VARCHAR},
      </if>
      <if test="consigneeId != null" >
        consignee_id = #{consigneeId,jdbcType=INTEGER},
      </if>
      <if test="pickupSelfTime != null" >
        pickup_self_time = #{pickupSelfTime,jdbcType=TIMESTAMP},
      </if>
      <if test="deliveryTime != null" >
        delivery_time = #{deliveryTime,jdbcType=TIMESTAMP},
      </if>
      <if test="transportType != null" >
        transport_type = #{transportType,jdbcType=VARCHAR},
      </if>
      <if test="status != null" >
        status = #{status,jdbcType=INTEGER},
      </if>
      <if test="isVoid != null" >
        is_void = #{isVoid,jdbcType=INTEGER},
      </if>
      <if test="createUser != null" >
        create_user = #{createUser,jdbcType=INTEGER},
      </if>
      <if test="updateUser != null" >
        update_user = #{updateUser,jdbcType=INTEGER},
      </if>
      <if test="updateTime != null" >
        update_time = #{updateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="reserved != null" >
        reserved = #{reserved,jdbcType=VARCHAR},
      </if>
    </set>
    where id = #{id,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.anji.allways.business.entity.OrderEntity" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Aug 23 17:12:20 CST 2017.
    -->
    update tb_order
    set no = #{no,jdbcType=VARCHAR},
      vin = #{vin,jdbcType=VARCHAR},
      vehicle_id = #{vehicleId,jdbcType=INTEGER},
      destination = #{destination,jdbcType=VARCHAR},
      warehouse_name = #{warehouseName,jdbcType=VARCHAR},
      warehouse_id = #{warehouseId,jdbcType=INTEGER},
      customer = #{customer,jdbcType=VARCHAR},
      customer_id = #{customerId,jdbcType=INTEGER},
      location = #{location,jdbcType=VARCHAR},
      create_time = #{createTime,jdbcType=TIMESTAMP},
      receive_time = #{receiveTime,jdbcType=TIMESTAMP},
      storage_plan_id = #{storagePlanId,jdbcType=INTEGER},
      delivery_plan_id = #{deliveryPlanId,jdbcType=INTEGER},
      storage_time = #{storageTime,jdbcType=TIMESTAMP},
      operator_name = #{operatorName,jdbcType=VARCHAR},
      ship_no = #{shipNo,jdbcType=VARCHAR},
      consignee_id = #{consigneeId,jdbcType=INTEGER},
      pickup_self_time = #{pickupSelfTime,jdbcType=TIMESTAMP},
      delivery_time = #{deliveryTime,jdbcType=TIMESTAMP},
      transport_type = #{transportType,jdbcType=VARCHAR},
      status = #{status,jdbcType=INTEGER},
      is_void = #{isVoid,jdbcType=INTEGER},
      create_user = #{createUser,jdbcType=INTEGER},
      update_user = #{updateUser,jdbcType=INTEGER},
      update_time = #{updateTime,jdbcType=TIMESTAMP},
      reserved = #{reserved,jdbcType=VARCHAR}
    where id = #{id,jdbcType=INTEGER}
  </update>
   
      <!-- 查询运单记录数（发运） -->
   <select id="selectOrderFYByConditionCount" resultType="java.lang.Integer" parameterType="java.util.Map" >
   		select 
			count(1)
		from tb_order 
		where 1=1
		<include refid="Base_Where_List_fy"/>
   </select>
   
   
   <!-- 查询运单记录数（自提）-->
   <select id="selectOrderZTByConditionCount" resultType="java.lang.Integer" parameterType="java.util.Map" >
	   SELECT count(1) FROM
	   (SELECT
			count(1)
		FROM
			tb_order
		WHERE
			1 = 1
		<include refid="Base_Where_List_zt"/>
		GROUP BY customer,warehouse_name,pickup_self_time
		) t
   </select>
   
   
    <!-- 查询运单列表(发运) -->
   <select id="selectOrderListFYByCondition" resultMap="BaseResultMap" parameterType="java.util.Map" >
		select 
		    id,
			no,
			create_time,
			vin,
			customer,
			destination
		from tb_order 
		where 1=1
		<include refid="Base_Where_List_fy"/>
		order by create_time DESC
		<if test="dbIndex != null and dbNumber != null">
	      limit ${dbIndex},${dbNumber}
	    </if>
   </select>
   
   
   
   <!-- 查询运单列表(自提) -->
   <select id="selectOrderListZTByCondition" resultMap="BaseResultMapZt" parameterType="java.util.Map" > 
		SELECT
			t.pickup_self_time,
			date_format(pickup_self_time,'%Y-%m-%d %H:%i:%S') pickupSelfTimeS,
			t.customer,
			t.warehouse_name,
		    nee.NAME consigneeName,
			nee.mobile consigneeMobile,
			nee.id consigneeId,
			t.order_num,
			t.warehouse_id,
			t.create_user
		FROM
			(
				SELECT
					pickup_self_time,
					customer,
					any_value(create_user) create_user,
					warehouse_id,
					ANY_VALUE(consignee_id) consigneeId,
					ANY_VALUE(warehouse_name) warehouse_name,
					count(1) order_num
				FROM
					tb_order
				WHERE
					1 = 1
					<include refid="Base_Where_List_zt"/>
				GROUP BY
					customer,
					warehouse_id,
					pickup_self_time
			) t
		LEFT JOIN tb_consignee nee ON t.consigneeId = nee.id
		ORDER BY t.pickup_self_time DESC
		<if test="dbIndex != null and dbNumber != null">
	      limit ${dbIndex},${dbNumber}
	    </if>
   </select>
   
    <!-- 查询一个集合下所包含的运单记录（自提） -->
   <select id="selectOrderSubZTByCondition" resultMap="BaseResultMapZt" parameterType="com.anji.allways.business.vo.OrderVO" > 
	   SELECT
	        id,
			no,
			create_time,
			vin,
			customer,
			pickup_self_time
		FROM
			tb_order
		WHERE
			1 = 1
		<include refid="Base_Where_List_zt_child"/>
		ORDER BY pickup_self_time DESC
   </select>
   
   
   
   <!-- 发运类根据条件拆分订单（发运） -->
    <select id="selectOrderGroup" resultMap="BaseResultMap">
	  SELECT
			customer_id,
			destination,
			consignee_id,
			ANY_VALUE(customer) customer
		FROM
			tb_order
		WHERE
		    1=1
			and id in
	    <foreach collection="list" index="index" item="item" open="(" separator="," close=")">
	        #{item}
	    </foreach>
		GROUP BY
			customer_id,
			destination,
			consignee_id
	    ORDER BY customer_id desc
   </select>
   
   <!-- 主出库计划单下不存在子计划单（发运、自提） -->
   <update id="updateOrderDeliveryPlanId" parameterType="java.util.Map" >
	    update tb_order 
	    <set> 
	     <trim suffixOverrides=",">
		    <if test="deliveryPlanId!=null and deliveryPlanId!='' ">
		    	delivery_plan_id = #{deliveryPlanId,jdbcType=INTEGER},
		    </if>
		    <if test="status!=null and status!='' ">
		    	status = #{status,jdbcType=INTEGER},
		    </if>
		  </trim>
	    </set>
	    where 
	    	1=1
	    	<if test=" list!=null and list.size>0 ">
			    and id in
			    <foreach collection="list" index="index" item="item" open="(" separator="," close=")">
			        #{item}
			    </foreach>
		    </if>
		    <if test=" list.size==0 ">
		    	1!=1
		    </if>
	</update>
   
   

   <select id="selectOrderIdByVehicleId" resultType="java.util.Map">
		SELECT id,transport_type AS transportType,delivery_plan_id AS deliveryPlanId FROM tb_order
		WHERE vehicle_id=#{vehicleId,jdbcType=INTEGER} AND STATUS!=6
		ORDER BY create_time DESC
   </select>
   
   <!-- 主出库计划单下存在多个子计划单，分别遍历更新每个子计划单下的运单状态（发运） -->
   <update id="updateOrderDeliveryPlanIdSub" parameterType="java.util.Map" >
	  update
			tb_order
		set delivery_plan_id = #{deliveryPlanId},status = #{status}
		WHERE
		    1=1
		    <if test="customerId != null and customerId != '' ">
				and customer_id = #{customerId}
			</if>
			<if test="destination != null and destination != '' ">
				and destination = #{destination}
			</if>
			<if test="consigneeId != null and consigneeId != '' ">
				and consignee_id = #{consigneeId}
			</if>
			<if test=" list!=null and list.size >0 ">
			    and id in
			    <foreach collection="list" index="index" item="item" open="(" separator="," close=")">
			        #{item}
			    </foreach>
		    </if>
		    AND status in (1,2,3)
			AND transport_type = '发运'
      		AND is_void = 0
   </update>
   
   <!-- 查询所有订单是否交接完成  -->
   <select id="selectOrderIdByVehicleIdCount" resultType="java.lang.Integer">
		SELECT COUNT(1) FROM tb_order b
		LEFT JOIN tb_vehicle v ON b.vehicle_id=v.id
		WHERE b.delivery_plan_id=#{deliveryId,jdbcType=INTEGER} AND b.status=7
   </select>
   
   <!-- 根据订单id查询商品车id -->
   <select id="selectVehicleId" parameterType="java.util.Map" resultMap="BaseResultMap">
	    select vehicle_id from  tb_order 
	    where 
	    	1=1
	    	<if test=" list!=null and list.size >0 ">
			    and id in
			    <foreach collection="list" index="index" item="item" open="(" separator="," close=")">
			        #{item}
			    </foreach>
		    </if>
	</select>
   
   <!-- 根据运单号id更新运单状态 -->
   <update id="updateOrderStruts" parameterType="java.util.Map" >
	    update tb_order set status = #{status}
	    where 
	    	1=1
	    	<if test=" list!=null and list.size >0 ">
			    and id in
			    <foreach collection="list" index="index" item="item" open="(" separator="," close=")">
			        #{item}
			    </foreach>
		    </if>
	</update>
	
	<!-- 主出库计划单下不存在子计划单（发运、自提） -->
   <update id="updateOrderIncomeTime" parameterType="java.util.Map" >
	    update tb_order set receive_time = #{receiveTime,jdbcType=VARCHAR}
	    where id = #{id,jdbcType=INTEGER}
	</update>
	
	<!-- 根据计划单id更新运单状态 -->
   <update id="updateOrderStrutsByDeliveryPlanId" parameterType="java.util.Map" >
	    update tb_order
	    set status = #{status,jdbcType=INTEGER}
		where 
	    	1=1
	    	<if test=" deliveryPlanId!=null and deliveryPlanId!=''  ">
			    and delivery_plan_id = #{deliveryPlanId,jdbcType=INTEGER}
		    </if>
		     AND status != 6
	</update>
   
   <!-- 根据计划单id更新运单状态 -->
   <select id="selectOrderByDeliveryPlanId" resultType="java.lang.Integer" parameterType="java.util.Map" >
	    select count(1) from tb_order
	    where 
	    	1=1
	    	<if test=" list!=null and list.size >0 ">
	    		and delivery_plan_id in 
		    	<foreach collection="list" index="index" item="item" open="(" separator="," close=")">
			        #{item}
			    </foreach>
		    </if>
		    <if test=" list.size == 0 ">
		    	and 1 !=1
		    </if>
		    
	</select>
	
	<!-- 单个更新运单的状态 -->
	<update id="updateOrderStrutsOrderId" parameterType="java.util.Map" >
	    update tb_order set status = #{status},delivery_time = #{deliveryTime}  where id = #{id,jdbcType=INTEGER}
	</update>
	
	<!-- 根据订单id查询商品车id -->
   <select id="selectVehicleIdByOrderId" parameterType="java.lang.Integer" resultMap="BaseResultMap">
	    select vehicle_id,delivery_plan_id,transport_type,status from  tb_order 
	    where 
	    	1=1
	    	<if test=" id != null ">
			    and id = #{id,jdbcType=INTEGER}
		    </if>
		    AND status != 6
	</select>
	
   <!-- 查询导出订单记录 -->
   <select id="queryOrderRecordsForExportData" resultType="java.util.LinkedHashMap" parameterType="java.util.Map" >
    select 
	    IFNULL(tb_order.NO,'') AS 运输订单,
		IFNULL(DATE_FORMAT(tb_order.CREATE_TIME,'%Y-%m-%d %H:%i:%S'),'') AS 下单时间,
		IFNULL(tb_order.VIN,'') AS VIN码,
		IFNULL(tb_delivery_plan.SHIP_NO,'') AS 交接单号,
		IFNULL(tb_order.CUSTOMER,'') AS 客户名,
		IFNULL(DATE_FORMAT(tb_order.PICKUP_SELF_TIME,'%Y-%m-%d %H:%i:%S'),'') AS 自提时间,
		IFNULL(DATE_FORMAT(tb_order.DELIVERY_TIME,'%Y-%m-%d %H:%i:%S'),'') AS 出库时间,
		IFNULL(tb_order.LOCATION,'') AS 库位号,
		IFNULL(tb_order.TRANSPORT_TYPE,'') AS 配送方式,
		CASE
			WHEN tb_order.STATUS = 1 THEN
				'待调度'
			WHEN tb_order.STATUS = 2 THEN
				'待自提'
			WHEN tb_order.STATUS = 3 THEN
				'待出库'
			WHEN tb_order.STATUS = 4 OR tb_order.STATUS = 7 THEN
				'待收货'
			WHEN tb_order.STATUS = 5 THEN
				'已完成'
			WHEN tb_order.STATUS = 6 THEN
				'已取消'
      		ELSE
				''
			END AS 状态
    from tb_order 
    left join tb_delivery_plan on
    (tb_delivery_plan.id=tb_order.delivery_plan_id)
    where 1=1
        <include refid="Base_Where_List_Filters"/>
    order by tb_order.id desc
  </select>
  
  
  <!-- 计划单取消运单操作 -->
   <update id="updateOrderStrutsForEditInit" parameterType="java.util.Map">
	    update tb_order 
	    	set status = #{status},
	    		delivery_plan_id = 0
	    where 
	    	1=1
	    	<if test=" deliveryPlanId!=null and deliveryPlanId!=''  ">
			    and delivery_plan_id = #{deliveryPlanId,jdbcType=INTEGER}
		    </if>
		     AND status in (2,3)
	</update>
  
  <!-- 更具计划id获取所有的运单id，状态为：待调度 -->
   <select id="selectOrderIds" parameterType="java.lang.Integer"  resultMap="BaseResultMap">
	    select vehicle_id from tb_order
	    where 
	    	1=1
	    	<if test=" deliveryPlanId!=null and DeliveryPlanId!=''  ">
			    and delivery_plan_id = #{deliveryPlanId,jdbcType=INTEGER}
		    </if>
		     AND status = 1
	</select>
	
	<!--查询计划单下已交接的运单数-->
   <select id="selectCountHandover" parameterType="java.lang.Integer"  resultType="java.lang.Integer">
	    select count(1) from tb_order
	    where 
	    	1=1
	    	<if test=" deliveryPlanId!=null and deliveryPlanId!=''  ">
			    and delivery_plan_id = #{deliveryPlanId,jdbcType=INTEGER}
		    </if>
		     AND status not in (0,1,2,3)
	</select>
	
	<update id="updateOrderShipNoByPlanId" parameterType="java.util.Map">
	    update tb_order set ship_no = #{shipNo,jdbcType=VARCHAR} where delivery_plan_id = #{deliveryPlanId,jdbcType=INTEGER}
	</update>
	
	<update id="updateReceiveTimeByPlanId" parameterType="java.util.Map">
	    update tb_order set receive_time = #{receiveTime} where delivery_plan_id IN (SELECT id FROM tb_delivery_plan WHERE parent_id = #{deliveryPlanId,jdbcType=INTEGER} )
	</update>

	<!-- 创建出库计划单时，判断所选运单是否是否为待调度状态 -->
	<select id="checkOrderIsCancel" parameterType="java.util.Map" resultType="java.lang.Integer">
		select count(1) FROM tb_order where  status = 6
		<if test="idList !=null and idList.size>0">
			and id in
			<foreach collection="idList" index="index" item="item" open="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
	</select>
	
	
	
	
	
	<!-- *****************************以下改版新增代码************************************* -->
	<!-- 首页数据查询 -->
	<select id="selectHomepageData" parameterType="java.util.Map" resultMap="homePage">
		SELECT MAX(ZKS) ZKS, MAX(DDD) DDD, MAX(DCK) DCK,MAX(DZT) DZT
		FROM(
			SELECT
				STATUS,
				MAX(CASE WHEN STATUS = '1' THEN orderCount ELSE 0 END) 'DDD',
				MAX(CASE WHEN STATUS = '3' THEN orderCount ELSE	0 END) 'DCK',
				MAX(CASE WHEN STATUS = '2' THEN orderCount ELSE 0 END) 'DZT',
		    	MAX(CASE WHEN STATUS = '4' THEN orderCount ELSE 0 END) 'ZKS'
			FROM
				(
					SELECT STATUS,count(*) orderCount FROM tb_order
					WHERE  1=1
					<if test=" warehouseIdList!=null and warehouseIdList.size >0 ">
	    				and warehouse_id in 
		    			<foreach collection="warehouseIdList" index="index" item="item" open="(" separator="," close=")">
			       			 #{item}
			    		</foreach>
		    		</if> 
		    		<if test=" create_user!=null and create_user!='' ">
		    			and create_user = #{createUser,jdbcType=INTEGER}
		    		</if>
					GROUP BY STATUS HAVING status in (1,2,3) 
					UNION
					SELECT '4' as STATUS, count(1) orderCount FROM tb_vehicle WHERE vehicle_status in (0,1,2,3) 
					<if test=" warehouseIdList!=null and warehouseIdList.size >0 ">
	    				and warehouse_id in 
		    			<foreach collection="warehouseIdList" index="index" item="item" open="(" separator="," close=")">
			       			 #{item}
			    		</foreach>
		    		</if> 
		    		<if test=" create_user!=null and create_user!='' ">
		    			and create_user = #{createUser,jdbcType=INTEGER}
		    		</if>
				) t 
			GROUP BY t.STATUS
		  ) t1
	</select>
	
	
	
	<!-- 待调度数据列表查询 -->
	<select id="selectOrderListByCondition" parameterType="java.util.Map" resultMap="BaseResultMap">
		SELECT
		    o.id,
			o.vin,
		 	veh.brand,
			veh.model,
			IFNULL(veh.manufacturer_color,veh.standard_color_id) vehicleColor,
			o.create_time,
			o.location,
			o.warehouse_id,
			warehouse_name,
			o.customer,
			o.pickup_self_time,
			o.consignee_id,
			con.name consignee_name,
			con.mobile consignee_mobile
		FROM
			tb_order o INNER JOIN tb_vehicle veh ON o.vehicle_id =veh.id  
			left join tb_consignee con on o.consignee_id = con.id
		    where 1=1
		    <if test=" warehouseIdList!=null and warehouseIdList.size >0 ">
   				and o.warehouse_id in 
    			<foreach collection="warehouseIdList" index="index" item="item" open="(" separator="," close=")">
	       			 #{item}
	    		</foreach>
    		</if> 
    		<if test=" create_user!=null and create_user!='' ">
    			and o.create_user = #{createUser,jdbcType=INTEGER}
    		</if>
    		<if test=" status!=null and status!='' ">
    			and o.status = #{status,jdbcType=INTEGER}
    		</if>
		    <if test=" transportType!=null and transportType!='' ">
    			and o.transport_type = #{transportType,jdbcType=VARCHAR}
    		</if>
    		<if test=' transportType == "自提" '>
    			ORDER BY customer,pickup_self_time,warehouse_id,consignee_id,create_time DESC
    		</if>
    		<if test=' transportType == "发运" '>
    			ORDER BY create_time DESC
    		</if>
    	
	</select>
	
</mapper>
