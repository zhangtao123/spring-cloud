<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.anji.allways.business.mapper.TransportCompanyEntityMapper" >
  <resultMap id="BaseResultMap" type="com.anji.allways.business.vo.TransportCompanyVO" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Aug 23 17:12:20 CST 2017.
    -->
    <id column="id" property="id" jdbcType="INTEGER" />
    <result column="name" property="name" jdbcType="VARCHAR" />
    <result column="province_name" property="provinceName" jdbcType="VARCHAR" />
    <result column="province_code" property="provinceCode" jdbcType="VARCHAR" />
    <result column="city_name" property="cityName" jdbcType="VARCHAR" />
    <result column="city_code" property="cityCode" jdbcType="VARCHAR" />
    <result column="district_name" property="districtName" jdbcType="VARCHAR" />
    <result column="district_code" property="districtCode" jdbcType="VARCHAR" />
    <result column="address" property="address" jdbcType="VARCHAR" />
    <result column="contactor" property="contactor" jdbcType="VARCHAR" />
    <result column="contactor_mobile" property="contactorMobile" jdbcType="VARCHAR" />
    <result column="driver_amount" property="driverAmount" jdbcType="INTEGER" />
    <result column="status" property="status" jdbcType="INTEGER" />
    <result column="favorable_rate" property="favorableRate" jdbcType="REAL" />
    <result column="ontime_rate" property="ontimeRate" jdbcType="REAL" />
    <result column="comment" property="comment" jdbcType="VARCHAR" />
    <result column="create_user" property="createUser" jdbcType="INTEGER" />
    <result column="create_time" property="createTime" jdbcType="TIMESTAMP" />
    <result column="update_user" property="updateUser" jdbcType="INTEGER" />
    <result column="update_time" property="updateTime" jdbcType="TIMESTAMP" />
  </resultMap>
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Aug 23 17:12:20 CST 2017.
    -->
    id, name, province_name,province_code,city_name,city_code,district_name,district_code, address, contactor, contactor_mobile, driver_amount, status, favorable_rate, 
    ontime_rate, comment, create_user, create_time, update_user, update_time
  </sql>
  
   <!--   分页查询 -->
   <select id="queryCompanyInfos" resultMap="BaseResultMap" parameterType="com.anji.allways.business.entity.TransportCompanyEntity" >
    select 
    	<include refid="Base_Column_List" />
    from tb_transport_company
    where 1=1
    	<include refid="Base_Where_List"/>
	order by create_time desc
	<if test="dbIndex != null and dbNumber != null">
      limit #{dbIndex},#{dbNumber}
    </if>
  </select>
  <!--   分页查询件数查询 -->
   <select id="queryCompanyInfosCount" resultType="java.lang.Integer" parameterType="com.anji.allways.business.entity.TransportCompanyEntity" >
    select 
    	count(1)
    from tb_transport_company
    where 1=1
    	<include refid="Base_Where_List"/>
  </select>
  
  <!--   分页查询条件 -->
  <sql id="Base_Where_List" >
  	<if test="name != null and name != ''">
		and name like concat("%",#{name},"%")
	</if>
	<if test="provinceCode != null and provinceCode != ''">
		and province_code = #{provinceCode}
	</if>
	<if test="cityCode != null and cityCode != ''">
		and city_code = #{cityCode}
	</if>
	<if test="districtCode != null and districtCode != ''">
		and district_code = #{districtCode}
	</if>
	<if test="contactor != null and contactor != ''">
		and contactor like concat("%",#{contactor},"%")
	</if>
	<if test="contactorMobile != null and contactorMobile != ''">
		and contactor_mobile like concat("%",#{contactorMobile},"%")
	</if>
	<if test="searchStatus != null and searchStatus !=''">
		and status = #{searchStatus}
	</if>
	<if test="createStartTime != null and createStartTime != ''">
		and date_format(create_time,'%Y-%m-%d') >= #{createStartTime}
	</if>
	<if test="createEndTime != null and createEndTime != ''">
		and date_format(create_time,'%Y-%m-%d') <![CDATA[<=]]> #{createEndTime}
	</if>
	<if test="favorableRateStart != null and favorableRateStart != ''">
		and favorable_rate >= #{favorableRateStart}
	</if>
	<if test="favorableRateEnd != null and favorableRateEnd != ''">
		and favorable_rate <![CDATA[<=]]> #{favorableRateEnd}
	</if>
	<if test="ontimeRateStart != null and ontimeRateStart != ''">
		and ontime_rate >= #{ontimeRateStart}
	</if>
	<if test="ontimeRateEnd != null and ontimeRateEnd != ''">
		and ontime_rate <![CDATA[<=]]> #{ontimeRateEnd}
	</if>
  </sql>
  
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Aug 23 17:12:20 CST 2017.
    -->
    select 
    <include refid="Base_Column_List" />
    from tb_transport_company
    where id = #{id,jdbcType=INTEGER}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Aug 23 17:12:20 CST 2017.
    -->
    delete from tb_transport_company
    where id = #{id,jdbcType=INTEGER}
  </delete>
  <insert id="insert" useGeneratedKeys="true" keyProperty="id" parameterType="com.anji.allways.business.entity.TransportCompanyEntity" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Aug 23 17:12:20 CST 2017.
    -->
    insert into tb_transport_company (name, province_name,province_code,city_name,
      city_code,district_name,district_code, 
      address, contactor, contactor_mobile, 
      driver_amount, status, favorable_rate, 
      ontime_rate, comment, create_user, 
      create_time, update_user, update_time
      )
    values (#{name,jdbcType=VARCHAR}, 
      #{provinceName,jdbcType=VARCHAR},#{provinceCode,jdbcType=VARCHAR},
      #{cityName,jdbcType=VARCHAR},#{cityCode,jdbcType=VARCHAR},
      #{districtName,jdbcType=VARCHAR},#{districtCode,jdbcType=VARCHAR}, 
      #{address,jdbcType=VARCHAR}, #{contactor,jdbcType=VARCHAR}, #{contactorMobile,jdbcType=VARCHAR}, 
      #{driverAmount,jdbcType=INTEGER}, #{status,jdbcType=INTEGER}, #{favorableRate,jdbcType=REAL}, 
      #{ontimeRate,jdbcType=REAL}, #{comment,jdbcType=VARCHAR}, #{createUser,jdbcType=INTEGER}, 
      #{createTime,jdbcType=TIMESTAMP}, #{updateUser,jdbcType=INTEGER}, #{updateTime,jdbcType=TIMESTAMP}
      )
  </insert>
  <insert id="insertSelective" parameterType="com.anji.allways.business.entity.TransportCompanyEntity" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Aug 23 17:12:20 CST 2017.
    -->
    insert into tb_transport_company
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        id,
      </if>
      <if test="name != null" >
        name,
      </if>
      <if test="provinceName != null and provinceName != ''">
		 province_name,
	  </if>
	  <if test="provinceCode != null and provinceCode != ''">
	     province_code,
	  </if>
	  <if test="cityName != null and cityName != ''">
		city_name,
	  </if>
	  <if test="cityCode != null and cityCode != ''">
		city_code,
	  </if>
	  <if test="districtName != null and districtName != ''">
		district_name,
	  </if>
	  <if test="districtCode != null and districtCode != ''">
		district_code,
	  </if>
      <if test="address != null" >
        address,
      </if>
      <if test="contactor != null" >
        contactor,
      </if>
      <if test="contactorMobile != null" >
        contactor_mobile,
      </if>
      <if test="driverAmount != null" >
        driver_amount,
      </if>
      <if test="status != null" >
        status,
      </if>
      <if test="favorableRate != null" >
        favorable_rate,
      </if>
      <if test="ontimeRate != null" >
        ontime_rate,
      </if>
      <if test="comment != null" >
        comment,
      </if>
      <if test="createUser != null" >
        create_user,
      </if>
      <if test="createTime != null" >
        create_time,
      </if>
      <if test="updateUser != null" >
        update_user,
      </if>
      <if test="updateTime != null" >
        update_time,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        #{id,jdbcType=INTEGER},
      </if>
      <if test="name != null" >
        #{name,jdbcType=VARCHAR},
      </if>
      <if test="provinceName != null and provinceName != ''">
		 #{provinceName,jdbcType=VARCHAR},
	  </if>
	  <if test="provinceCode != null and provinceCode != ''">
		#{provinceCode,jdbcType=VARCHAR},
	  </if>
	  <if test="cityName != null and cityName != ''">
		#{cityName,jdbcType=VARCHAR},
	  </if>
	  <if test="cityCode != null and cityCode != ''">
		#{cityCode,jdbcType=VARCHAR},
	  </if>
	  <if test="districtName != null and districtName != ''">
		#{districtName,jdbcType=VARCHAR},
	  </if>
	  <if test="districtCode != null and districtCode != ''">
		#{districtCode,jdbcType=VARCHAR},
	  </if>
      <if test="address != null" >
        #{address,jdbcType=VARCHAR},
      </if>
      <if test="contactor != null" >
        #{contactor,jdbcType=VARCHAR},
      </if>
      <if test="contactorMobile != null" >
        #{contactorMobile,jdbcType=VARCHAR},
      </if>
      <if test="driverAmount != null" >
        #{driverAmount,jdbcType=INTEGER},
      </if>
      <if test="status != null" >
        #{status,jdbcType=INTEGER},
      </if>
      <if test="favorableRate != null" >
        #{favorableRate,jdbcType=REAL},
      </if>
      <if test="ontimeRate != null" >
        #{ontimeRate,jdbcType=REAL},
      </if>
      <if test="comment != null" >
        #{comment,jdbcType=VARCHAR},
      </if>
      <if test="createUser != null" >
        #{createUser,jdbcType=INTEGER},
      </if>
      <if test="createTime != null" >
        #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="updateUser != null" >
        #{updateUser,jdbcType=INTEGER},
      </if>
      <if test="updateTime != null" >
        #{updateTime,jdbcType=TIMESTAMP},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.anji.allways.business.entity.TransportCompanyEntity" >
    update tb_transport_company
    <set >
      <if test="name != null" >
        name = #{name,jdbcType=VARCHAR},
      </if>
      <if test="provinceName != null and provinceName != ''">
		province_name = #{provinceName,jdbcType=VARCHAR},
	  </if>
      <if test="provinceCode != null and provinceCode != ''">
		province_code = #{provinceCode,jdbcType=VARCHAR},
	  </if>
	  <if test="cityName != null and cityName != ''">
		city_name = #{cityName,jdbcType=VARCHAR},
	  </if>
	  <if test="cityCode != null and cityCode != ''">
		city_code = #{cityCode,jdbcType=VARCHAR},
	  </if>
	  <if test="districtName != null and districtName != ''">
		district_name = #{districtName,jdbcType=VARCHAR},
	  </if>
	  <if test="districtCode != null and districtCode != ''">
		district_code = #{districtCode,jdbcType=VARCHAR},
	  </if>
      <if test="address != null" >
        address = #{address,jdbcType=VARCHAR},
      </if>
      <if test="contactor != null" >
        contactor = #{contactor,jdbcType=VARCHAR},
      </if>
      <if test="contactorMobile != null" >
        contactor_mobile = #{contactorMobile,jdbcType=VARCHAR},
      </if>
      <if test="driverAmount != null" >
        driver_amount = #{driverAmount,jdbcType=INTEGER},
      </if>
      <if test="status != null" >
        status = #{status,jdbcType=INTEGER},
      </if>
      <if test="favorableRate != null" >
        favorable_rate = #{favorableRate,jdbcType=REAL},
      </if>
      <if test="ontimeRate != null" >
        ontime_rate = #{ontimeRate,jdbcType=REAL},
      </if>
      <if test="comment != null" >
        comment = #{comment,jdbcType=VARCHAR},
      </if>
      <if test="createUser != null" >
        create_user = #{createUser,jdbcType=INTEGER},
      </if>
      <if test="createTime != null" >
        create_time = #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="updateUser != null" >
        update_user = #{updateUser,jdbcType=INTEGER},
      </if>
      <if test="updateTime != null" >
        update_time = #{updateTime,jdbcType=TIMESTAMP},
      </if>
    </set>
    where id = #{id,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.anji.allways.business.entity.TransportCompanyEntity" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Aug 23 17:12:20 CST 2017.
    -->
    update tb_transport_company
    set name = #{name,jdbcType=VARCHAR},
	  province_name = #{provinceName,jdbcType=VARCHAR},
	  province_code = #{provinceCode,jdbcType=VARCHAR},
	  city_name = #{cityName,jdbcType=VARCHAR},
	  city_code = #{cityCode,jdbcType=VARCHAR},
	  district_name = #{districtName,jdbcType=VARCHAR},
	  district_code = #{districtCode,jdbcType=VARCHAR},
      address = #{address,jdbcType=VARCHAR},
      contactor = #{contactor,jdbcType=VARCHAR},
      contactor_mobile = #{contactorMobile,jdbcType=VARCHAR},
      driver_amount = #{driverAmount,jdbcType=INTEGER},
      status = #{status,jdbcType=INTEGER},
      favorable_rate = #{favorableRate,jdbcType=REAL},
      ontime_rate = #{ontimeRate,jdbcType=REAL},
      comment = #{comment,jdbcType=VARCHAR},
      create_user = #{createUser,jdbcType=INTEGER},
      create_time = #{createTime,jdbcType=TIMESTAMP},
      update_user = #{updateUser,jdbcType=INTEGER},
      update_time = #{updateTime,jdbcType=TIMESTAMP}
    where id = #{id,jdbcType=INTEGER}
  </update>
  
   <select id="checkRepeatValue" resultType="java.lang.Integer" parameterType="Map" >
    select 
    count(1)
    from tb_transport_company
    where 1=1
    <if test="id != null and id !=''" >
       and id <![CDATA[<>]]> #{id}
    </if>
    <if test="name != null and name !=''" >
       and name = #{name,jdbcType=VARCHAR}
    </if>
  </select>
  
  <!-- 获取运输公司信息下拉列表 -->
  <select id="queryCompanyForDict" resultType="com.anji.allways.business.vo.DictVO" parameterType="Map" >
	select id as code, name
	from tb_transport_company
	where status =1
	<if test="name != null and name != ''">
		and name like concat("%",#{name},"%")
	</if>
	order by create_time desc
  </select>
  
  <update id="updateByIdList" parameterType="java.util.Map">
    update tb_transport_company
      set status = #{status,jdbcType=INTEGER},
      update_user = #{userId,jdbcType=INTEGER},
      update_time = current_timestamp()
    where 
    status <![CDATA[<>]]> #{status,jdbcType=INTEGER}
    and id in
    <foreach collection="idList" index="index" item="item" open="(" separator="," close=")">
        #{item}
    </foreach>
  </update>
  
  <!--   编辑运输公司时，更新信息 -->
  <update id="updateByIDForEditCompany" parameterType="com.anji.allways.business.entity.TransportCompanyEntity" >
    update tb_transport_company
    <set >
      <if test="name != null" >
        name = #{name,jdbcType=VARCHAR},
      </if>
      <if test="provinceName != null and provinceName != ''">
		province_name = #{provinceName,jdbcType=VARCHAR},
	  </if>
      <if test="provinceCode != null and provinceCode != ''">
		province_code = #{provinceCode,jdbcType=VARCHAR},
	  </if>
	  <if test="cityName != null and cityName != ''">
		city_name = #{cityName,jdbcType=VARCHAR},
	  </if>
	  <if test="cityCode != null and cityCode != ''">
		city_code = #{cityCode,jdbcType=VARCHAR},
	  </if>
	  <if test="districtName != null and districtName != ''">
		district_name = #{districtName,jdbcType=VARCHAR},
	  </if>
	  <if test="districtCode != null and districtCode != ''">
		district_code = #{districtCode,jdbcType=VARCHAR},
	  </if>
      <if test="address != null" >
        address = #{address,jdbcType=VARCHAR},
      </if>
      <if test="contactor != null" >
        contactor = #{contactor,jdbcType=VARCHAR},
      </if>
      <if test="contactorMobile != null" >
        contactor_mobile = #{contactorMobile,jdbcType=VARCHAR},
      </if>
      <if test="updateUser != null" >
        update_user = #{updateUser,jdbcType=INTEGER},
      </if>
      <if test="updateTime != null" >
        update_time = #{updateTime,jdbcType=TIMESTAMP},
      </if>
    </set>
    where id = #{id,jdbcType=INTEGER}
  </update>
  
  <!-- check所选运输公司下司机是否已经全部停用 -->
  <select id="checkCompanyAllDriver" resultType="java.lang.String" parameterType="java.util.Map" >
	select DISTINCT t.name
	from tb_transport_company t
	inner join tb_truck_driver t1 on 
	(t1.transport_company_id = t.id
	and t1.status=1)
	where 
    t.status = 1
    and t.id in
    <foreach collection="idList" index="index" item="item" open="(" separator="," close=")">
        #{item}
    </foreach>
  </select>
</mapper>