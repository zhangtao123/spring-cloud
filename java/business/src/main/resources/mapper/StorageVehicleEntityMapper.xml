<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.anji.allways.business.mapper.StorageVehicleEntityMapper" >
  <resultMap id="BaseResultMap" type="com.anji.allways.business.entity.StorageVehicleEntity" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Aug 23 17:12:20 CST 2017.
    -->
    <id column="id" property="id" jdbcType="INTEGER" />
    <result column="vin" property="vin" jdbcType="VARCHAR" />
    <result column="brand" property="brand" jdbcType="VARCHAR" />
    <result column="series" property="series" jdbcType="VARCHAR" />
    <result column="model" property="model" jdbcType="VARCHAR" />
    <result column="color" property="color" jdbcType="VARCHAR" />
    <result column="location" property="location" jdbcType="VARCHAR" />
    <result column="license_number" property="licenseNumber" jdbcType="VARCHAR" />
    <result column="registration_number" property="registrationNumber" jdbcType="VARCHAR" />
    <result column="vehicle_type" property="vehicleType" jdbcType="INTEGER" />
    <result column="storage_plan_id" property="storagePlanId" jdbcType="INTEGER" />
    <result column="delivery_plan_no" property="deliveryPlanNo" jdbcType="VARCHAR" />
    <result column="reserved" property="reserved" jdbcType="VARCHAR" />
    <result column="vehicle_comment" property="vehicleComment" jdbcType="VARCHAR" />
    <result column="is_storage" property="isStorage" jdbcType="INTEGER" />
  </resultMap>
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Aug 23 17:12:20 CST 2017.
    -->
    id, vin, brand, series, model, color, location, license_number, registration_number, 
    vehicle_type, storage_plan_id, delivery_plan_no, reserved,vehicle_comment,is_storage
  </sql>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Aug 23 17:12:20 CST 2017.
    -->
    select 
    <include refid="Base_Column_List" />
    from tb_storage_vehicle
    where id = #{id,jdbcType=INTEGER}
  </select>
  <select id="selectByPlanId" resultMap="BaseResultMap" parameterType="java.lang.Integer" >
    select 
    <include refid="Base_Column_List" />
    from tb_storage_vehicle
    where storage_plan_id = #{id,jdbcType=INTEGER}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Aug 23 17:12:20 CST 2017.
    -->
    delete from tb_storage_vehicle
    where id = #{id,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="com.anji.allways.business.entity.StorageVehicleEntity" useGeneratedKeys="true" keyProperty="id">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Aug 23 17:12:20 CST 2017.
    -->
    insert into tb_storage_vehicle (id, vin, brand, 
      series, model, color, 
      location, license_number, registration_number, 
      vehicle_type, storage_plan_id, delivery_plan_no, 
      reserved,vehicle_comment,is_storage)
    values (#{id,jdbcType=INTEGER}, #{vin,jdbcType=VARCHAR}, #{brand,jdbcType=VARCHAR}, 
      #{series,jdbcType=VARCHAR}, #{model,jdbcType=VARCHAR}, #{color,jdbcType=VARCHAR}, 
      #{location,jdbcType=VARCHAR}, #{licenseNumber,jdbcType=VARCHAR}, #{registrationNumber,jdbcType=VARCHAR}, 
      #{vehicleType,jdbcType=INTEGER}, #{storagePlanId,jdbcType=INTEGER}, #{deliveryPlanNo,jdbcType=VARCHAR}, 
      #{reserved,jdbcType=VARCHAR},#{vehicleComment,jdbcType=VARCHAR},#{isStorage,jdbcType=INTEGER})
  </insert>
  <insert id="insertSelective" parameterType="com.anji.allways.business.entity.StorageVehicleEntity" useGeneratedKeys="true" keyProperty="id">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Aug 23 17:12:20 CST 2017.
    -->
    insert into tb_storage_vehicle
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        id,
      </if>
      <if test="vin != null" >
        vin,
      </if>
      <if test="brand != null" >
        brand,
      </if>
      <if test="series != null" >
        series,
      </if>
      <if test="model != null" >
        model,
      </if>
      <if test="color != null" >
        color,
      </if>
      <if test="location != null" >
        location,
      </if>
      <if test="licenseNumber != null" >
        license_number,
      </if>
      <if test="registrationNumber != null" >
        registration_number,
      </if>
      <if test="vehicleType != null" >
        vehicle_type,
      </if>
      <if test="storagePlanId != null" >
        storage_plan_id,
      </if>
      <if test="deliveryPlanNo != null" >
        delivery_plan_no,
      </if>
      <if test="reserved != null" >
        reserved,
      </if>
      <if test="vehicleComment != null" >
        vehicle_comment,
      </if>
      <if test="isStorage != null" >
        is_storage,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        #{id,jdbcType=INTEGER},
      </if>
      <if test="vin != null" >
        #{vin,jdbcType=VARCHAR},
      </if>
      <if test="brand != null" >
        #{brand,jdbcType=VARCHAR},
      </if>
      <if test="series != null" >
        #{series,jdbcType=VARCHAR},
      </if>
      <if test="model != null" >
        #{model,jdbcType=VARCHAR},
      </if>
      <if test="color != null" >
        #{color,jdbcType=VARCHAR},
      </if>
      <if test="location != null" >
        #{location,jdbcType=VARCHAR},
      </if>
      <if test="licenseNumber != null" >
        #{licenseNumber,jdbcType=VARCHAR},
      </if>
      <if test="registrationNumber != null" >
        #{registrationNumber,jdbcType=VARCHAR},
      </if>
      <if test="vehicleType != null" >
        #{vehicleType,jdbcType=INTEGER},
      </if>
      <if test="storagePlanId != null" >
        #{storagePlanId,jdbcType=INTEGER},
      </if>
      <if test="deliveryPlanNo != null" >
        #{deliveryPlanNo,jdbcType=VARCHAR},
      </if>
      <if test="reserved != null" >
        #{reserved,jdbcType=VARCHAR},
      </if>
      <if test="vehicleComment != null" >
        #{vehicleComment,jdbcType=VARCHAR},
      </if>
      <if test="isStorage != null" >
        #{isStorage,jdbcType=INTEGER},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.anji.allways.business.entity.StorageVehicleEntity" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Aug 23 17:12:20 CST 2017.
    -->
    update tb_storage_vehicle
    <set >
      <if test="vin != null" >
        vin = #{vin,jdbcType=VARCHAR},
      </if>
      <if test="brand != null" >
        brand = #{brand,jdbcType=VARCHAR},
      </if>
      <if test="series != null" >
        series = #{series,jdbcType=VARCHAR},
      </if>
      <if test="model != null" >
        model = #{model,jdbcType=VARCHAR},
      </if>
      <if test="color != null" >
        color = #{color,jdbcType=VARCHAR},
      </if>
      <if test="location != null" >
        location = #{location,jdbcType=VARCHAR},
      </if>
      <if test="licenseNumber != null" >
        license_number = #{licenseNumber,jdbcType=VARCHAR},
      </if>
      <if test="registrationNumber != null" >
        registration_number = #{registrationNumber,jdbcType=VARCHAR},
      </if>
      <if test="vehicleType != null" >
        vehicle_type = #{vehicleType,jdbcType=INTEGER},
      </if>
      <if test="storagePlanId != null" >
        storage_plan_id = #{storagePlanId,jdbcType=INTEGER},
      </if>
      <if test="deliveryPlanNo != null" >
        delivery_plan_no = #{deliveryPlanNo,jdbcType=VARCHAR},
      </if>
      <if test="reserved != null" >
        reserved = #{reserved,jdbcType=VARCHAR},
      </if>
      <if test="vehicleComment != null" >
        vehicle_comment=#{vehicleComment,jdbcType=VARCHAR},
      </if>
       <if test="isStorage != null" >
        is_storage = #{isStorage,jdbcType=INTEGER},
      </if>
    </set>
    where id = #{id,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.anji.allways.business.entity.StorageVehicleEntity" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Aug 23 17:12:20 CST 2017.
    -->
    update tb_storage_vehicle
    set vin = #{vin,jdbcType=VARCHAR},
      brand = #{brand,jdbcType=VARCHAR},
      series = #{series,jdbcType=VARCHAR},
      model = #{model,jdbcType=VARCHAR},
      color = #{color,jdbcType=VARCHAR},
      location = #{location,jdbcType=VARCHAR},
      license_number = #{licenseNumber,jdbcType=VARCHAR},
      registration_number = #{registrationNumber,jdbcType=VARCHAR},
      vehicle_type = #{vehicleType,jdbcType=INTEGER},
      storage_plan_id = #{storagePlanId,jdbcType=INTEGER},
      delivery_plan_no = #{deliveryPlanNo,jdbcType=VARCHAR},
      reserved = #{reserved,jdbcType=VARCHAR},
      vehicle_comment=#{vehicleComment,jdbcType=VARCHAR},
      is_storage = #{isStorage,jdbcType=INTEGER},
    where id = #{id,jdbcType=INTEGER}
  </update>
  <update id="updateByVinAndId" parameterType="com.anji.allways.business.entity.StorageVehicleEntity" >
    update tb_storage_vehicle
    <set>
      <if test="location != null" >
        location = #{location,jdbcType=VARCHAR},
      </if>
      <if test="vehicleComment != null" >
        vehicle_comment = #{vehicleComment,jdbcType=VARCHAR},
      </if>
    </set>
    where id = #{id,jdbcType=INTEGER}
  </update>
  
  <!--   修改计划单车辆信息 -->
  <update id="updateStorageVehicleByPrimaryKey" parameterType="java.util.Map" >
    update tb_storage_vehicle
    <set >
      <if test="vehicleComment != null" >
        vehicle_comment=#{vehicleComment,jdbcType=VARCHAR},
      </if>
       <if test="isStorage != null" >
        is_storage = #{isStorage,jdbcType=INTEGER},
      </if>
    </set>
    where id = #{id,jdbcType=INTEGER}
  </update>
  
   <!--  校验重复值 -->
   <select id="checkRepeatValue" resultType="java.lang.Integer" parameterType="Map" >
    select 
    count(1)
    from tb_storage_vehicle
    where 1=1
    <if test="id != null and id !=''" >
       and id <![CDATA[<>]]> #{id}
    </if>
    <if test="location != null and location !=''" >
       and location = #{location,jdbcType=VARCHAR}
    </if>
  </select>
  
   <!--  根据VIN码检索是否已经在库中存在 -->
   <select id="checkVehicleVIN" resultType="java.lang.String" parameterType="java.lang.String" >
	    SELECT
			tb_storage_plan.NO
		FROM
			tb_storage_vehicle
		INNER JOIN tb_storage_plan ON (
			tb_storage_plan.id = tb_storage_vehicle.storage_plan_id
			AND tb_storage_plan.STATUS <![CDATA[<>]]> 2
		)
		WHERE
			tb_storage_vehicle.vin = #{vin}
		AND CASE
		WHEN tb_storage_plan.STATUS = 1 THEN
			EXISTS (
				SELECT
					tb_vehicle.id
				FROM
					tb_vehicle
				WHERE
					tb_vehicle.storage_vehicle_id = tb_storage_vehicle.id
				AND tb_vehicle.vehicle_status IN (0, 1, 2, 3, 6)
			)
		ELSE
			1 = 1
		END
		LIMIT 0,1
    </select>
</mapper>