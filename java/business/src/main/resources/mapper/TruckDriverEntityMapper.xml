<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.anji.allways.business.mapper.TruckDriverEntityMapper" >
  <resultMap id="BaseResultMap" type="com.anji.allways.business.vo.TruckDriverVO" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Aug 23 17:12:20 CST 2017.
    -->
    <id column="id" property="id" jdbcType="INTEGER" />
    <result column="mobile" property="mobile" jdbcType="VARCHAR" />
    <result column="name" property="name" jdbcType="VARCHAR" />
    <result column="id_card_no" property="idCardNo" jdbcType="VARCHAR" />
    <result column="id_card_front_picture" property="idCardFrontPicture" jdbcType="VARCHAR" />
    <result column="id_card_back_picture" property="idCardBackPicture" jdbcType="VARCHAR" />
    <result column="account_name" property="accountName" jdbcType="VARCHAR" />
    <result column="transport_company_name" property="transportCompanyName" jdbcType="VARCHAR" />
    <result column="transport_company_id" property="transportCompanyId" jdbcType="INTEGER" />
    <result column="truck_number" property="truckNumber" jdbcType="VARCHAR" />
    <result column="status" property="status" jdbcType="INTEGER" />
    <result column="create_user" property="createUser" jdbcType="INTEGER" />
    <result column="create_time" property="createTime" jdbcType="TIMESTAMP" />
    <result column="update_user" property="updateUser" jdbcType="INTEGER" />
    <result column="update_time" property="updateTime" jdbcType="TIMESTAMP" />
    <result column="reserved" property="reserved" jdbcType="VARCHAR" />
  </resultMap>
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Aug 23 17:12:20 CST 2017.
    -->
    id, mobile, name, id_card_no, id_card_front_picture, id_card_back_picture, account_name, 
    transport_company_name, transport_company_id, truck_number, status, create_user, 
    create_time, update_user, update_time, reserved
  </sql>
  
  <!-- 根据检索条件查询列表 -->
	<select id="queryTruckDriverInfos" resultMap="BaseResultMap"
		parameterType="com.anji.allways.business.entity.TruckDriverEntity">
		select 
		 <include refid="Base_Column_List" />
		from tb_truck_driver
		where 1=1
		<include refid="Base_Where_List"/>
		order by create_time desc
		<if test="dbIndex != null and dbNumber != null">
	      limit #{dbIndex},#{dbNumber}
	    </if>
	</select>
	
	<!--   分页查询件数查询 -->
   <select id="queryTruckDriverInfosCount" resultType="java.lang.Integer" parameterType="com.anji.allways.business.entity.TruckDriverEntity" >
    select 
    	count(1)
    from tb_truck_driver
    where 1=1
    	<include refid="Base_Where_List"/>
  </select>
  
   <!--   分页查询条件 -->
  <sql id="Base_Where_List" >
  		<if test="name != null and name != ''">
			and name like concat("%",#{name},"%")
		</if>
		<if test="mobile != null and mobile != ''">
			and mobile like concat("%",#{mobile},"%")
		</if>
		<if test="truckNumber != null and truckNumber != ''">
			and truck_number like concat("%",#{truckNumber},"%")
		</if>
		<if test="accountName != null and accountName != ''">
			and account_name like concat("%",#{accountName},"%")
		</if>
		<if test="transportCompanyId != null and transportCompanyId != ''">
			and transport_company_id = #{transportCompanyId}
		</if>
		<if test="transportCompanyName != null and transportCompanyName != ''">
			and transport_company_name = #{transportCompanyName}
		</if>
		<if test="searchStatus != null and searchStatus != ''">
			and status = #{searchStatus}
		</if>
		<if test="createStartTime != null and createStartTime != ''">
			and date_format(create_time,'%Y-%m-%d') >= #{createStartTime}
		</if>
		<if test="createEndTime != null and createEndTime != ''">
			and date_format(create_time,'%Y-%m-%d') <![CDATA[<=]]> #{createEndTime}
		</if>
  </sql>
	
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Aug 23 17:12:20 CST 2017.
    -->
    select 
    <include refid="Base_Column_List" />
    from tb_truck_driver
    where id = #{id,jdbcType=INTEGER}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Aug 23 17:12:20 CST 2017.
    -->
    delete from tb_truck_driver
    where id = #{id,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="com.anji.allways.business.entity.TruckDriverEntity" useGeneratedKeys="true" keyProperty="id">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Aug 23 17:12:20 CST 2017.
    -->
    insert into tb_truck_driver (mobile, name, 
      id_card_no, id_card_front_picture, id_card_back_picture, 
      account_name, transport_company_name, transport_company_id, 
      truck_number, status, create_user, 
      create_time, update_user, update_time, 
      reserved)
    values (#{mobile,jdbcType=VARCHAR}, #{name,jdbcType=VARCHAR}, 
      #{idCardNo,jdbcType=VARCHAR}, #{idCardFrontPicture,jdbcType=VARCHAR}, #{idCardBackPicture,jdbcType=VARCHAR}, 
      #{accountName,jdbcType=VARCHAR}, #{transportCompanyName,jdbcType=VARCHAR}, #{transportCompanyId,jdbcType=INTEGER}, 
      #{truckNumber,jdbcType=VARCHAR}, #{status,jdbcType=INTEGER}, #{createUser,jdbcType=INTEGER}, 
      #{createTime,jdbcType=TIMESTAMP}, #{updateUser,jdbcType=INTEGER}, #{updateTime,jdbcType=TIMESTAMP}, 
      #{reserved,jdbcType=VARCHAR})
  </insert>
  <insert id="insertSelective" parameterType="com.anji.allways.business.entity.TruckDriverEntity" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Aug 23 17:12:20 CST 2017.
    -->
    insert into tb_truck_driver
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        id,
      </if>
      <if test="mobile != null" >
        mobile,
      </if>
      <if test="name != null" >
        name,
      </if>
      <if test="idCardNo != null" >
        id_card_no,
      </if>
      <if test="idCardFrontPicture != null" >
        id_card_front_picture,
      </if>
      <if test="idCardBackPicture != null" >
        id_card_back_picture,
      </if>
      <if test="accountName != null" >
        account_name,
      </if>
      <if test="transportCompanyName != null" >
        transport_company_name,
      </if>
      <if test="transportCompanyId != null" >
        transport_company_id,
      </if>
      <if test="truckNumber != null" >
        truck_number,
      </if>
      <if test="status != null" >
        status,
      </if>
      <if test="createUser != null" >
        create_user,
      </if>
      <if test="createTime != null" >
        create_time,
      </if>
      <if test="updateUser != null" >
        update_user,
      </if>
      <if test="updateTime != null" >
        update_time,
      </if>
      <if test="reserved != null" >
        reserved,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        #{id,jdbcType=INTEGER},
      </if>
      <if test="mobile != null" >
        #{mobile,jdbcType=VARCHAR},
      </if>
      <if test="name != null" >
        #{name,jdbcType=VARCHAR},
      </if>
      <if test="idCardNo != null" >
        #{idCardNo,jdbcType=VARCHAR},
      </if>
      <if test="idCardFrontPicture != null" >
        #{idCardFrontPicture,jdbcType=VARCHAR},
      </if>
      <if test="idCardBackPicture != null" >
        #{idCardBackPicture,jdbcType=VARCHAR},
      </if>
      <if test="accountName != null" >
        #{accountName,jdbcType=VARCHAR},
      </if>
      <if test="transportCompanyName != null" >
        #{transportCompanyName,jdbcType=VARCHAR},
      </if>
      <if test="transportCompanyId != null" >
        #{transportCompanyId,jdbcType=INTEGER},
      </if>
      <if test="truckNumber != null" >
        #{truckNumber,jdbcType=VARCHAR},
      </if>
      <if test="status != null" >
        #{status,jdbcType=INTEGER},
      </if>
      <if test="createUser != null" >
        #{createUser,jdbcType=INTEGER},
      </if>
      <if test="createTime != null" >
        #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="updateUser != null" >
        #{updateUser,jdbcType=INTEGER},
      </if>
      <if test="updateTime != null" >
        #{updateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="reserved != null" >
        #{reserved,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.anji.allways.business.entity.TruckDriverEntity" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Aug 23 17:12:20 CST 2017.
    -->
    update tb_truck_driver
    <set >
      <if test="mobile != null" >
        mobile = #{mobile,jdbcType=VARCHAR},
      </if>
      <if test="name != null" >
        name = #{name,jdbcType=VARCHAR},
      </if>
      <if test="idCardNo != null" >
        id_card_no = #{idCardNo,jdbcType=VARCHAR},
      </if>
      <if test="idCardFrontPicture != null" >
        id_card_front_picture = #{idCardFrontPicture,jdbcType=VARCHAR},
      </if>
      <if test="idCardBackPicture != null" >
        id_card_back_picture = #{idCardBackPicture,jdbcType=VARCHAR},
      </if>
      <if test="accountName != null" >
        account_name = #{accountName,jdbcType=VARCHAR},
      </if>
      <if test="transportCompanyName != null" >
        transport_company_name = #{transportCompanyName,jdbcType=VARCHAR},
      </if>
      <if test="transportCompanyId != null" >
        transport_company_id = #{transportCompanyId,jdbcType=INTEGER},
      </if>
      <if test="truckNumber != null" >
        truck_number = #{truckNumber,jdbcType=VARCHAR},
      </if>
      <if test="status != null" >
        status = #{status,jdbcType=INTEGER},
      </if>
      <if test="createUser != null" >
        create_user = #{createUser,jdbcType=INTEGER},
      </if>
      <if test="createTime != null" >
        create_time = #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="updateUser != null" >
        update_user = #{updateUser,jdbcType=INTEGER},
      </if>
      <if test="updateTime != null" >
        update_time = #{updateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="reserved != null" >
        reserved = #{reserved,jdbcType=VARCHAR},
      </if>
    </set>
    where id = #{id,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.anji.allways.business.entity.TruckDriverEntity" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Aug 23 17:12:20 CST 2017.
    -->
    update tb_truck_driver
    set mobile = #{mobile,jdbcType=VARCHAR},
      name = #{name,jdbcType=VARCHAR},
      id_card_no = #{idCardNo,jdbcType=VARCHAR},
      id_card_front_picture = #{idCardFrontPicture,jdbcType=VARCHAR},
      id_card_back_picture = #{idCardBackPicture,jdbcType=VARCHAR},
      account_name = #{accountName,jdbcType=VARCHAR},
      transport_company_name = #{transportCompanyName,jdbcType=VARCHAR},
      transport_company_id = #{transportCompanyId,jdbcType=INTEGER},
      truck_number = #{truckNumber,jdbcType=VARCHAR},
      status = #{status,jdbcType=INTEGER},
      create_user = #{createUser,jdbcType=INTEGER},
      create_time = #{createTime,jdbcType=TIMESTAMP},
      update_user = #{updateUser,jdbcType=INTEGER},
      update_time = #{updateTime,jdbcType=TIMESTAMP},
      reserved = #{reserved,jdbcType=VARCHAR}
    where id = #{id,jdbcType=INTEGER}
  </update>
  
  <update id="updateByIdList" parameterType="java.util.Map">
    update tb_truck_driver
      set status = #{status,jdbcType=INTEGER},
      update_user = #{userId,jdbcType=INTEGER},
      update_time = current_timestamp()
    where 
    status <![CDATA[<>]]> #{status,jdbcType=INTEGER}
    and id in
    <foreach collection="idList" index="index" item="item" open="(" separator="," close=")">
        #{item}
    </foreach>
  </update>
  
  <!-- 校验要启用的司机是否在其他公司为启用状态 -->
  <select id="checkOhterCompanyByIdList" parameterType="java.util.Map" resultMap="BaseResultMap">
    SELECT
    <include refid="Base_Column_List" />
	FROM
		tb_truck_driver
	WHERE
	STATUS = 1
	AND mobile IN (
		SELECT
			mobile
		FROM
			tb_truck_driver
		WHERE id IN
	    <foreach collection="idList" index="index" item="item" open="(" separator="," close=")">
	        #{item}
	    </foreach>
    ) 
    AND ID NOT IN
	    <foreach collection="idList" index="index" item="item" open="(" separator="," close=")">
	        #{item}
	    </foreach>
    limit 0,1
  </select>
  
   <select id="checkRepeatValue" resultType="java.lang.Integer" parameterType="Map" >
    select 
    count(1)
    from tb_truck_driver
    where 1=1
    <if test="id != null and id !=''" >
       and id <![CDATA[<>]]> #{id}
    </if>
    <if test="name != null and name !=''" >
       and name = #{name,jdbcType=VARCHAR}
    </if>
    <if test="truckNumber != null and truckNumber !=''" >
       and truck_number = #{truckNumber,jdbcType=VARCHAR}
    </if>
    <if test="accountName != null and accountName !=''" >
       and account_name = #{accountName,jdbcType=VARCHAR}
    </if>
     <if test="mobile != null and mobile !=''" >
       and mobile = #{mobile,jdbcType=VARCHAR}
    </if>
  </select>
  
  <!--   根据电话号码查询运输司机 -->
  <select id="selectInfoByMoblie" resultMap="BaseResultMap" parameterType="java.lang.String" >
    select 
    <include refid="Base_Column_List" />
    from tb_truck_driver
    where mobile = #{mobile}
    ORDER BY create_time DESC
  </select>
  
  <!--   编辑司机时，更新信息 -->
  <update id="updateByIDForEditDriver" parameterType="com.anji.allways.business.entity.TruckDriverEntity" >
    update tb_truck_driver
    <set >
      <if test="mobile != null" >
        mobile = #{mobile,jdbcType=VARCHAR},
      </if>
      <if test="name != null" >
        name = #{name,jdbcType=VARCHAR},
      </if>
      <if test="idCardNo != null" >
        id_card_no = #{idCardNo,jdbcType=VARCHAR},
      </if>
      <if test="idCardFrontPicture != null" >
        id_card_front_picture = #{idCardFrontPicture,jdbcType=VARCHAR},
      </if>
      <if test="idCardBackPicture != null" >
        id_card_back_picture = #{idCardBackPicture,jdbcType=VARCHAR},
      </if>
      <if test="accountName != null" >
        account_name = #{accountName,jdbcType=VARCHAR},
      </if>
      <if test="transportCompanyName != null" >
        transport_company_name = #{transportCompanyName,jdbcType=VARCHAR},
      </if>
      <if test="transportCompanyId != null" >
        transport_company_id = #{transportCompanyId,jdbcType=INTEGER},
      </if>
      <if test="truckNumber != null" >
        truck_number = #{truckNumber,jdbcType=VARCHAR},
      </if>
      <if test="updateUser != null" >
        update_user = #{updateUser,jdbcType=INTEGER},
      </if>
      <if test="updateTime != null" >
        update_time = #{updateTime,jdbcType=TIMESTAMP},
      </if>
    </set>
    where id = #{id,jdbcType=INTEGER}
  </update>
  
  <!--  校验选中的司机是否有出库任务正在进行 -->
  <select id="checkAllDriver" resultType="java.lang.String" parameterType="java.util.Map" >
    select 
    distinct t.name
    from tb_truck_driver t
    inner join tb_delivery_plan t1 on
    (t1.driver_id = t.id and
    t1.status <![CDATA[<>]]> 5)
    where 
    t.status = 1
    and t.id in
    <foreach collection="idList" index="index" item="item" open="(" separator="," close=")">
        #{item}
    </foreach>
  </select>
</mapper>