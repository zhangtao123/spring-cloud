<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.anji.allways.business.mapper.WarehouseEntityMapper">
	<resultMap id="BaseResultMap"
		type="com.anji.allways.business.entity.WarehouseEntity">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Wed Aug 23 
			17:12:20 CST 2017. -->
		<id column="id" property="id" jdbcType="INTEGER" />
		<result column="name" property="name" jdbcType="VARCHAR" />
		<result column="short_name" property="shortName" jdbcType="VARCHAR" />
		<result column="parent_id" property="parentId" jdbcType="INTEGER" />
		<result column="company_id" property="companyId" jdbcType="INTEGER" />
		<result column="space_amount" property="spaceAmount" jdbcType="INTEGER" />
		<result column="occupied_amount" property="occupiedAmount"
			jdbcType="INTEGER" />
		<result column="province_name" property="provinceName"
			jdbcType="VARCHAR" />
		<result column="province_code" property="provinceCode"
			jdbcType="VARCHAR" />
		<result column="city_name" property="cityName" jdbcType="VARCHAR" />
		<result column="city_code" property="cityCode" jdbcType="VARCHAR" />
		<result column="district_name" property="districtName"
			jdbcType="VARCHAR" />
		<result column="district_code" property="districtCode"
			jdbcType="VARCHAR" />
		<result column="address" property="address" jdbcType="VARCHAR" />
		<result column="longitude" property="longitude" jdbcType="REAL" />
		<result column="latitude" property="latitude" jdbcType="REAL" />
		<result column="register_picture_path" property="registerPicturePath"
			jdbcType="VARCHAR" />
		<result column="contactor" property="contactor" jdbcType="VARCHAR" />
		<result column="contactor_mobile" property="contactorMobile"
			jdbcType="VARCHAR" />
		<result column="business_start_time" property="businessStartTime"
			jdbcType="VARCHAR" />
		<result column="business_end_time" property="businessEndTime"
			jdbcType="VARCHAR" />
		<result column="warning_empty_amount" property="warningEmptyAmount"
			jdbcType="INTEGER" />
		<result column="warning_occupied_percent" property="warningOccupiedPercent"
			jdbcType="REAL" />
		<result column="comment" property="comment" jdbcType="VARCHAR" />
		<result column="status" property="status" jdbcType="INTEGER" />
		<result column="reserved" property="reserved" jdbcType="VARCHAR" />
		<result column="create_user" property="createUser" jdbcType="INTEGER" />
		<result column="create_time" property="createTime" jdbcType="TIMESTAMP" />
		<result column="update_user" property="updateUser" jdbcType="INTEGER" />
		<result column="update_time" property="updateTime" jdbcType="TIMESTAMP" />
		<result column="warning_type" property="warningType" jdbcType="INTEGER" />
	</resultMap>

	<resultMap id="BaseResultVOMap" type="com.anji.allways.business.vo.WarehouseVO">
		<id column="id" property="id" jdbcType="INTEGER" />
		<result column="name" property="name" jdbcType="VARCHAR" />
		<result column="short_name" property="shortName" jdbcType="VARCHAR" />
		<result column="parent_id" property="parentId" jdbcType="INTEGER" />
		<result column="company_id" property="companyId" jdbcType="INTEGER" />
		<result column="space_amount" property="spaceAmount" jdbcType="INTEGER" />
		<result column="occupied_amount" property="occupiedAmount"
			jdbcType="INTEGER" />
		<result column="province_name" property="provinceName"
			jdbcType="VARCHAR" />
		<result column="province_code" property="provinceCode"
			jdbcType="VARCHAR" />
		<result column="city_name" property="cityName" jdbcType="VARCHAR" />
		<result column="city_code" property="cityCode" jdbcType="VARCHAR" />
		<result column="district_name" property="districtName"
			jdbcType="VARCHAR" />
		<result column="district_code" property="districtCode"
			jdbcType="VARCHAR" />
		<result column="address" property="address" jdbcType="VARCHAR" />
		<result column="longitude" property="longitude" jdbcType="REAL" />
		<result column="latitude" property="latitude" jdbcType="REAL" />
		<result column="register_picture_path" property="registerPicturePath"
			jdbcType="VARCHAR" />
		<result column="contactor" property="contactor" jdbcType="VARCHAR" />
		<result column="contactor_mobile" property="contactorMobile"
			jdbcType="VARCHAR" />
		<result column="business_start_time" property="businessStartTime"
			jdbcType="VARCHAR" />
		<result column="business_end_time" property="businessEndTime"
			jdbcType="VARCHAR" />
		<result column="warning_empty_amount" property="warningEmptyAmount"
			jdbcType="INTEGER" />
		<result column="warning_occupied_percent" property="warningOccupiedPercent"
			jdbcType="REAL" />
		<result column="comment" property="comment" jdbcType="VARCHAR" />
		<result column="status" property="status" jdbcType="INTEGER" />
		<result column="reserved" property="reserved" jdbcType="VARCHAR" />
		<result column="create_user" property="createUser" jdbcType="INTEGER" />
		<result column="create_time" property="createTime" jdbcType="TIMESTAMP" />
		<result column="update_user" property="updateUser" jdbcType="INTEGER" />
		<result column="update_time" property="updateTime" jdbcType="TIMESTAMP" />
		<result column="use_rate" property="useRate" jdbcType="VARCHAR" />
		<result column="customer_num" property="customerNum" jdbcType="VARCHAR" />
		<result column="free_amount" property="freeAmount" jdbcType="VARCHAR" />
		<result column="warning_type" property="warningType" jdbcType="INTEGER" />
	</resultMap>

	<!-- 返回结果�?仓库层级查询显示) -->
	<resultMap type="com.anji.allways.business.vo.WarehouseLevelVO"
		id="levelMap">
		<id column="id" property="id" />
		<result column="name" property="text" />
		<result column="parent_id" property="parentId" />
		<collection property="children" column="{parentId=id} "
			ofType="com.anji.allways.business.vo.WarehouseLevelVO" select="findLevelChildByParentId"></collection>
	</resultMap>

	<!-- 返回结果�?根据仓库ID获取库容信息) -->
	<resultMap type="com.anji.allways.business.vo.WarehouseVO"
		id="warehouseCustomerMap">
		<id column="id" property="id" jdbcType="INTEGER" />
		<result column="name" property="name" jdbcType="VARCHAR" />
		<result column="short_name" property="shortName" jdbcType="VARCHAR" />
		<result column="province_name" property="provinceName" jdbcType="VARCHAR" />
		<result column="city_name" property="cityName" jdbcType="VARCHAR" />
		<result column="district_name" property="districtName" jdbcType="VARCHAR" />
		<result column="space_amount" property="spaceAmount" jdbcType="INTEGER" />
		<result column="customer_num" property="customerNum" jdbcType="VARCHAR" />
		<result column="warning_type" property="warningType" jdbcType="INTEGER" />
		<result column="warning_empty_amount" property="warningEmptyAmount" jdbcType="INTEGER" />
		<result column="warning_occupied_percent" property="warningOccupiedPercent" jdbcType="REAL" />
		<collection property="customerList" column="{warehouseId=id} "
			ofType="com.anji.allways.business.vo.WarehouseLinkCustomerVO" select="findCustomerInfoByWarehouseId">
			<id column="id" property="id" />
			<result column="customer_id" property="customerId" jdbcType="INTEGER" />
			<result column="warehouse_id" property="warehouseId" jdbcType="INTEGER" />
			<result column="space_amount" property="spaceAmount" jdbcType="INTEGER" />
			<result column="customer_name" property="customerName"
				jdbcType="VARCHAR" />
		</collection>
	</resultMap>

	<sql id="Base_Column_List">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Wed Aug 23 
			17:12:20 CST 2017. -->
		id, name, short_name, parent_id, company_id, space_amount,
		occupied_amount, province_name,province_code,city_name,
		city_code,district_name,district_code,address, longitude, latitude,
		register_picture_path, contactor, contactor_mobile,
		business_start_time, business_end_time, warning_type,
		warning_empty_amount,warning_occupied_percent,
		comment, status, reserved, create_user, create_time, update_user, update_time
	</sql>
	<!-- 分页查询 -->
	<select id="queryWarehouseInfos" resultMap="BaseResultVOMap"
		parameterType="com.anji.allways.business.entity.WarehouseEntity">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Wed Aug 23 
			17:12:20 CST 2017. -->
		select
		id,
		name,
		short_name,
		province_name,
		city_name,
		district_name,
		address,
		longitude,
		latitude,
		business_start_time,
		business_end_time,
		contactor,
		contactor_mobile,
		status,
		create_time
		from tb_warehouse
		where 1=1
		<include refid="Base_Where_List" />
		order by create_time desc
		<if test="dbIndex != null and dbNumber != null">
			limit #{dbIndex},#{dbNumber}
		</if>
	</select>
	<!-- 分页查询件数查询 -->
	<select id="queryWarehouseInfosCount" resultType="java.lang.Integer"
		parameterType="com.anji.allways.business.entity.WarehouseEntity">
		select
		count(1)
		from tb_warehouse
		where 1=1
		<include refid="Base_Where_List" />
	</select>

	<!-- 分页查询条件 -->
	<sql id="Base_Where_List">
		<if test="name != null and name != ''">
			and (name like concat("%",#{name},"%")
			or short_name like concat("%",#{name},"%") )
		</if>
		<if test="contactor != null and contactor != ''">
			and contactor like concat("%",#{contactor},"%")
		</if>
		<if test="contactorMobile != null and contactorMobile != ''">
			and contactor_mobile like concat("%",#{contactorMobile},"%")
		</if>
		<if test="searchStatus != null and searchStatus !=''">
			and status = #{searchStatus}
		</if>
		<if test="provinceCode != null and provinceCode != ''">
			and province_code = #{provinceCode}
		</if>
		<if test="cityCode != null and cityCode != ''">
			and city_code = #{cityCode}
		</if>
		<if test="districtCode != null and districtCode != ''">
			and district_code = #{districtCode}
		</if>
		<if test="createUser != null and createUser != ''">
			and create_user = #{createUser}
		</if>
		<if test="createStartTime != null and createStartTime != ''">
			and date_format(create_time,'%Y-%m-%d') >= #{createStartTime}
		</if>
		<if test="createEndTime != null and createEndTime != ''">
			and date_format(create_time,'%Y-%m-%d') <![CDATA[<=]]> #{createEndTime}
		</if>
		<if test="idList !=null and idList.size>0">
			and id in
			<foreach collection="idList" index="index" item="item" open="("
				separator="," close=")">
				#{item}
			</foreach>
		</if>
	</sql>
	<select id="selectByPrimaryKey" resultMap="BaseResultMap"
		parameterType="java.lang.Integer">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Wed Aug 23 
			17:12:20 CST 2017. -->
		select
		<include refid="Base_Column_List" />
		from tb_warehouse
		where id = #{id,jdbcType=INTEGER}
	</select>
	<delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Wed Aug 23 
			17:12:20 CST 2017. -->
		delete from tb_warehouse
		where id = #{id,jdbcType=INTEGER}
	</delete>
	<insert id="insert" parameterType="com.anji.allways.business.entity.WarehouseEntity" useGeneratedKeys="true" keyProperty="id">
		insert into tb_warehouse (id, name, short_name,
		parent_id, company_id, space_amount,
		occupied_amount, province_name,province_code,city_name,city_code,
		district_name,district_code,address, longitude,
		latitude, register_picture_path, contactor,
		contactor_mobile, business_start_time, business_end_time,
		warning_type,warning_empty_amount, warning_occupied_percent,
		comment, status, reserved,
		create_user, create_time, update_user,
		update_time)
		values (#{id,jdbcType=INTEGER}, #{name,jdbcType=VARCHAR},
		#{shortName,jdbcType=VARCHAR},
		#{parentId,jdbcType=INTEGER}, #{companyId,jdbcType=INTEGER}, #{spaceAmount,jdbcType=INTEGER},
		#{occupiedAmount,jdbcType=INTEGER},
		#{provinceName,jdbcType=VARCHAR},#{provinceCode,jdbcType=VARCHAR},
		#{cityName,jdbcType=VARCHAR},#{cityCode,jdbcType=VARCHAR},
		#{districtName,jdbcType=VARCHAR},#{districtCode,jdbcType=VARCHAR},
		#{address,jdbcType=VARCHAR}, #{longitude,jdbcType=REAL},
		#{latitude,jdbcType=REAL}, #{registerPicturePath,jdbcType=VARCHAR},
		#{contactor,jdbcType=VARCHAR},
		#{contactorMobile,jdbcType=VARCHAR}, #{businessStartTime,jdbcType=VARCHAR},
		#{businessEndTime,jdbcType=VARCHAR},
		#{warningType,jdbcType=INTEGER},
		#{warningEmptyAmount,jdbcType=INTEGER},
		#{warningOccupiedPercent,jdbcType=REAL},
		#{comment,jdbcType=VARCHAR}, #{status,jdbcType=INTEGER}, #{reserved,jdbcType=VARCHAR},
		#{createUser,jdbcType=INTEGER}, #{createTime,jdbcType=TIMESTAMP},
		#{updateUser,jdbcType=INTEGER},
		#{updateTime,jdbcType=TIMESTAMP})
	</insert>
	<insert id="insertSelective" parameterType="com.anji.allways.business.entity.WarehouseEntity"
		useGeneratedKeys="true" keyProperty="id">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Wed Aug 23 
			17:12:20 CST 2017. -->
		insert into tb_warehouse
		<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="id != null">
				id,
			</if>
			<if test="name != null and name != ''">
				name,
			</if>
			<if test="shortName != null and shortName != ''">
				short_name,
			</if>
			<if test="parentId != null">
				parent_id,
			</if>
			<if test="companyId != null">
				company_id,
			</if>
			<if test="spaceAmount != null">
				space_amount,
			</if>
			<if test="occupiedAmount != null">
				occupied_amount,
			</if>
			<if test="provinceName != null and provinceName != ''">
				province_name,
			</if>
			<if test="provinceCode != null and provinceCode != ''">
				province_code,
			</if>
			<if test="cityName != null and cityName != ''">
				city_name,
			</if>
			<if test="cityCode != null and cityCode != ''">
				city_code,
			</if>
			<if test="districtName != null and districtName != ''">
				district_name,
			</if>
			<if test="districtCode != null and districtCode != ''">
				district_code,
			</if>
			<if test="address != null and address != ''">
				address,
			</if>
			<if test="longitude != null">
				longitude,
			</if>
			<if test="latitude != null">
				latitude,
			</if>
			<if test="registerPicturePath != null and registerPicturePath !=''">
				register_picture_path,
			</if>
			<if test="contactor != null and contactor !=''">
				contactor,
			</if>
			<if test="contactorMobile != null and contactorMobile !=''">
				contactor_mobile,
			</if>
			<if test="businessStartTime != null and businessStartTime !=''">
				business_start_time,
			</if>
			<if test="businessEndTime != null and businessEndTime !=''">
				business_end_time,
			</if>
			<if test="warningType != null">
				warning_type,
			</if>
			<if test="warningEmptyAmount != null">
				warning_empty_amount,
			</if>
			<if test="warningOccupiedPercent != null">
				warning_occupied_percent,
			</if>
			<if test="comment != null and comment !=''">
				comment,
			</if>
			<if test="status != null">
				status,
			</if>
			<if test="reserved != null and reserved !=''">
				reserved,
			</if>
			<if test="createUser != null">
				create_user,
			</if>
			<if test="createTime != null">
				create_time,
			</if>
			<if test="updateUser != null">
				update_user,
			</if>
			<if test="updateTime != null">
				update_time,
			</if>
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=",">
			<if test="id != null">
				#{id,jdbcType=INTEGER},
			</if>
			<if test="name != null and name !=''">
				#{name,jdbcType=VARCHAR},
			</if>
			<if test="shortName != null and shortName !=''">
				#{shortName,jdbcType=VARCHAR},
			</if>
			<if test="parentId != null">
				#{parentId,jdbcType=INTEGER},
			</if>
			<if test="companyId != null">
				#{companyId,jdbcType=INTEGER},
			</if>
			<if test="spaceAmount != null">
				#{spaceAmount,jdbcType=INTEGER},
			</if>
			<if test="occupiedAmount != null">
				#{occupiedAmount,jdbcType=INTEGER},
			</if>
			<if test="provinceName != null and provinceName != ''">
				#{provinceName,jdbcType=VARCHAR},
			</if>
			<if test="provinceCode != null and provinceCode != ''">
				#{provinceCode,jdbcType=VARCHAR},
			</if>
			<if test="cityName != null and cityName != ''">
				#{cityName,jdbcType=VARCHAR},
			</if>
			<if test="cityCode != null and cityCode != ''">
				#{cityCode,jdbcType=VARCHAR},
			</if>
			<if test="districtName != null and districtName != ''">
				#{districtName,jdbcType=VARCHAR},
			</if>
			<if test="districtCode != null and districtCode != ''">
				#{districtCode,jdbcType=VARCHAR},
			</if>
			<if test="address != null and address !=''">
				#{address,jdbcType=VARCHAR},
			</if>
			<if test="longitude != null">
				#{longitude,jdbcType=REAL},
			</if>
			<if test="latitude != null">
				#{latitude,jdbcType=REAL},
			</if>
			<if test="registerPicturePath != null and registerPicturePath !=''">
				#{registerPicturePath,jdbcType=VARCHAR},
			</if>
			<if test="contactor != null and contactor !=''">
				#{contactor,jdbcType=VARCHAR},
			</if>
			<if test="contactorMobile != null and contactorMobile !=''">
				#{contactorMobile,jdbcType=VARCHAR},
			</if>
			<if test="businessStartTime != null and businessStartTime !=''">
				#{businessStartTime,jdbcType=VARCHAR},
			</if>
			<if test="businessEndTime != null and businessEndTime !=''">
				#{businessEndTime,jdbcType=VARCHAR},
			</if>
			<if test="warningType != null">
				#{warningType,jdbcType=INTEGER},
			</if>
			<if test="warningEmptyAmount != null">
				#{warningEmptyAmount,jdbcType=INTEGER},
			</if>
			<if test="warningOccupiedPercent != null">
				#{warningOccupiedPercent,jdbcType=REAL},
			</if>
			<if test="comment != null and comment !=''">
				#{comment,jdbcType=VARCHAR},
			</if>
			<if test="status != null">
				#{status,jdbcType=INTEGER},
			</if>
			<if test="reserved != null and reserved !=''">
				#{reserved,jdbcType=VARCHAR},
			</if>
			<if test="createUser != null">
				#{createUser,jdbcType=INTEGER},
			</if>
			<if test="createTime != null">
				#{createTime,jdbcType=TIMESTAMP},
			</if>
			<if test="updateUser != null">
				#{updateUser,jdbcType=INTEGER},
			</if>
			<if test="updateTime != null">
				#{updateTime,jdbcType=TIMESTAMP},
			</if>
		</trim>
	</insert>
	<update id="updateByPrimaryKeySelective" parameterType="com.anji.allways.business.entity.WarehouseEntity">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Wed Aug 23 
			17:12:20 CST 2017. -->
		update tb_warehouse
		<trim suffixOverrides="," >
		<set>
			<if test="name != null and name !=''">
				name = #{name,jdbcType=VARCHAR},
			</if>
			<if test="shortName != null and shortName !=''">
				short_name = #{shortName,jdbcType=VARCHAR},
			</if>
			<if test="parentId != null">
				parent_id = #{parentId,jdbcType=INTEGER},
			</if>
			<if test="companyId != null">
				company_id = #{companyId,jdbcType=INTEGER},
			</if>
			<if test="spaceAmount != null">
				space_amount = #{spaceAmount,jdbcType=INTEGER},
			</if>
			<if test="occupiedAmount != null">
				occupied_amount = #{occupiedAmount,jdbcType=INTEGER},
			</if>
			<if test="provinceName != null and provinceName != ''">
				province_name = #{provinceName,jdbcType=VARCHAR},
			</if>
			<if test="provinceCode != null and provinceCode != ''">
				province_code = #{provinceCode,jdbcType=VARCHAR},
			</if>
			<if test="cityName != null and cityName != ''">
				city_name = #{cityName,jdbcType=VARCHAR},
			</if>
			<if test="cityCode != null and cityCode != ''">
				city_code = #{cityCode,jdbcType=VARCHAR},
			</if>
			<if test="districtName != null and districtName != ''">
				district_name = #{districtName,jdbcType=VARCHAR},
			</if>
			<if test="districtCode != null and districtCode != ''">
				district_code = #{districtCode,jdbcType=VARCHAR},
			</if>
			<if test="address != null and address !=''">
				address = #{address,jdbcType=VARCHAR},
			</if>
			<if test="longitude != null">
				longitude = #{longitude,jdbcType=REAL},
			</if>
			<if test="latitude != null">
				latitude = #{latitude,jdbcType=REAL},
			</if>
			<if test="registerPicturePath != null and registerPicturePath !=''">
				register_picture_path = #{registerPicturePath,jdbcType=VARCHAR},
			</if>
			<if test="contactor != null and contactor !=''">
				contactor = #{contactor,jdbcType=VARCHAR},
			</if>
			<if test="contactorMobile != null and contactorMobile !=''">
				contactor_mobile = #{contactorMobile,jdbcType=VARCHAR},
			</if>
			<if test="businessStartTime != null and businessStartTime !=''">
				business_start_time = #{businessStartTime,jdbcType=VARCHAR},
			</if>
			<if test="businessEndTime != null and businessEndTime !=''">
				business_end_time = #{businessEndTime,jdbcType=VARCHAR},
			</if>
			<if test="warningType != null">
				warning_type = #{warningType,jdbcType=INTEGER},
			</if>
			<if test="warningEmptyAmount != null">
				warning_empty_amount = #{warningEmptyAmount,jdbcType=INTEGER},
			</if>
			<if test="warningOccupiedPercent != null">
				warning_occupied_percent = #{warningOccupiedPercent,jdbcType=REAL},
			</if>
			<if test="comment != null and comment !=''">
				comment = #{comment,jdbcType=VARCHAR},
			</if>
			<if test="status != null">
				status = #{status,jdbcType=INTEGER},
			</if>
			<if test="reserved != null and reserved !=''">
				reserved = #{reserved,jdbcType=VARCHAR},
			</if>
			<if test="createUser != null">
				create_user = #{createUser,jdbcType=INTEGER},
			</if>
			<if test="createTime != null">
				create_time = #{createTime,jdbcType=TIMESTAMP},
			</if>
			<if test="updateUser != null">
				update_user = #{updateUser,jdbcType=INTEGER},
			</if>
			<if test="updateTime != null">
				update_time = #{updateTime,jdbcType=TIMESTAMP},
			</if>
		</set>
		</trim>
		where id = #{id,jdbcType=INTEGER}
	</update>
	<update id="updateByPrimaryKey" parameterType="com.anji.allways.business.entity.WarehouseEntity">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Wed Aug 23 
			17:12:20 CST 2017. -->
		update tb_warehouse
		set name = #{name,jdbcType=VARCHAR},
		short_name = #{shortName,jdbcType=VARCHAR},
		parent_id = #{parentId,jdbcType=INTEGER},
		company_id = #{companyId,jdbcType=INTEGER},
		space_amount = #{spaceAmount,jdbcType=INTEGER},
		occupied_amount = #{occupiedAmount,jdbcType=INTEGER},
		province_name = #{provinceName,jdbcType=VARCHAR},
		province_code = #{provinceCode,jdbcType=VARCHAR},
		city_name = #{cityName,jdbcType=VARCHAR},
		city_code = #{cityCode,jdbcType=VARCHAR},
		district_name = #{districtName,jdbcType=VARCHAR},
		district_code = #{districtCode,jdbcType=VARCHAR},
		address = #{address,jdbcType=VARCHAR},
		longitude = #{longitude,jdbcType=REAL},
		latitude = #{latitude,jdbcType=REAL},
		register_picture_path = #{registerPicturePath,jdbcType=VARCHAR},
		contactor = #{contactor,jdbcType=VARCHAR},
		contactor_mobile = #{contactorMobile,jdbcType=VARCHAR},
		business_start_time = #{businessStartTime,jdbcType=VARCHAR},
		business_end_time = #{businessEndTime,jdbcType=VARCHAR},
		warning_type = #{warningType,jdbcType=INTEGER},
		warning_empty_amount = #{warningEmptyAmount,jdbcType=INTEGER},
		warning_occupied_percent = #{warningOccupiedPercent,jdbcType=REAL},
		comment = #{comment,jdbcType=VARCHAR},
		status = #{status,jdbcType=INTEGER},
		reserved = #{reserved,jdbcType=VARCHAR},
		create_user = #{createUser,jdbcType=INTEGER},
		create_time = #{createTime,jdbcType=TIMESTAMP},
		update_user = #{updateUser,jdbcType=INTEGER},
		update_time = #{updateTime,jdbcType=TIMESTAMP}
		where id = #{id,jdbcType=INTEGER}
	</update>

	<select id="selectByCustomerId" resultType="java.util.Map"
		parameterType="java.lang.Integer">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Wed Aug 23 
			17:12:20 CST 2017. -->
		SELECT a.id AS warehousId,a.name AS warehousName FROM tb_warehouse a
		LEFT JOIN tb_warehouse_link_customer b ON a.id = b.warehouse_id
		LEFT JOIN tb_user c ON c.customer_id = b.customer_id
		WHERE
		c.id = #{userId,jdbcType=INTEGER}
	</select>

	<select id="getCount" resultType="java.lang.Integer">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Wed Aug 23 
			17:12:20 CST 2017. -->
		SELECT COUNT(1) FROM tb_warehouse a
		LEFT JOIN
		tb_warehouse_link_customer b ON a.id = b.warehouse_id
		LEFT JOIN tb_user c ON c.customer_id = b.customer_id
		WHERE c.id =#{userId,jdbcType=INTEGER}
	</select>

	<select id="getMyWarehouseById" resultMap="BaseResultMap">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Wed Aug 23 
			17:12:20 CST 2017. -->
		SELECT a.* FROM tb_warehouse a
		LEFT JOIN tb_warehouse_link_customer b
		ON a.id = b.warehouse_id
		LEFT JOIN tb_user c ON c.customer_id = b.customer_id
		WHERE c.id =
		#{userId,jdbcType=INTEGER}
		ORDER BY a.create_time desc
		LIMIT
		#{pageIndex,jdbcType=INTEGER},#{pageNumber,jdbcType=INTEGER}
	</select>
	<!-- 批量激活或停用仓库 -->
	<update id="updateByIdList" parameterType="java.util.Map">
		update tb_warehouse
		set status = #{status,jdbcType=INTEGER},
		update_user = #{userId,jdbcType=INTEGER},
		update_time = current_timestamp()
		where
		status <![CDATA[<>]]>
		#{status,jdbcType=INTEGER}
		and id in
		<foreach collection="idList" index="index" item="item" open="("
			separator="," close=")">
			#{item}
		</foreach>
	</update>

	<!-- 上一级仓库查询-->
	<select id="selectWarehouseLevelInfor" resultMap="levelMap"
		parameterType="java.util.Map">
		SELECT a.id,a.name,a.short_name,a.parent_id FROM tb_warehouse a
		WHERE
		status = 1
		<!-- 一级仓库的上级仓库ID为0 -->
		<if test="parentId == null and (name ==null or name =='')">
			and a.parent_id=0
		</if>
		<if test="parentId != null and parentId !=''">
			and a.id=#{parentId}
		</if>
		<if test="name !=null and name !=''">
			and (name like concat("%",#{name},"%")
			or short_name like concat("%",#{name},"%"))
		</if>
		<if test="createUser != null and createUser !=''">
			and a.create_user=#{createUser}
		</if>
		
	</select>
	<!-- 下级仓库查询 -->
	<select id="findLevelChildByParentId" resultMap="levelMap"
		parameterType="java.util.Map">
		SELECT b.id,b.name,b.short_name,b.parent_id FROM
		tb_warehouse b
		WHERE b.parent_id=#{parentId}
	</select>

	<!-- 值重复check -->
	<select id="checkRepeatValue" resultType="java.lang.Integer"
		parameterType="Map">
		select
		count(1)
		from tb_warehouse
		where 1=1
		<if test="id != null and id !=''">
			and id <![CDATA[<>]]>
			#{id}
		</if>
		<if test="name != null and name !=''">
			and name = #{name,jdbcType=VARCHAR}
		</if>
		<if test="shortName != null and shortName !=''">
			and short_name = #{shortName,jdbcType=VARCHAR}
		</if>
	</select>

	<!-- 分页查询 -->
	<select id="queryStorageInfos" resultMap="BaseResultVOMap"
		parameterType="com.anji.allways.business.entity.WarehouseEntity">
		SELECT
		a.id,
		a.NAME,
		a.short_name,
		a.province_name,
		a.city_name,
		a.district_name,
		a.space_amount,
		a.occupied_amount,
	    a.warning_type,
	    a.warning_empty_amount,
	    a.warning_occupied_percent,
		(a.space_amount- a.occupied_amount) as free_amount,
		IFNULL(
			ROUND(a.occupied_amount / a.space_amount * 100),
			0
		) AS use_rate,
		a.STATUS,
		a.create_time,
		COUNT(DISTINCT b.customer_id) AS customer_num
		FROM
		tb_warehouse a
		LEFT JOIN tb_warehouse_link_customer b ON (b.warehouse_id = a.id)
		where 1=1
		<include refid="Base_Where_List_Storage" />
		GROUP BY a.id
		order by a.create_time desc
		<if test="dbIndex != null and dbNumber != null">
			limit #{dbIndex},#{dbNumber}
		</if>
	</select>
	<!-- 分页查询件数查询 -->
	<select id="queryStorageInfosCount" resultType="java.lang.Integer"
		parameterType="com.anji.allways.business.entity.WarehouseEntity">
		select count(1) from (
			select
			a.id
			FROM
			tb_warehouse a
			LEFT JOIN tb_warehouse_link_customer b ON (b.warehouse_id = a.id)
			where 1=1
			<include refid="Base_Where_List_Storage" />
			GROUP BY a.id
		) T
	</select>

	<!-- 分页查询条件 -->
	<sql id="Base_Where_List_Storage">
		<if test="name != null and name != ''">
			and (a.name like concat("%",#{name},"%")
			or a.short_name like concat("%",#{name},"%") )
		</if>
		<if test="searchStatus != null and searchStatus !=''">
			and a.status = #{searchStatus}
		</if>
		<if test="provinceCode != null and provinceCode != ''">
			and a.province_code = #{provinceCode}
		</if>
		<if test="cityCode != null and cityCode != ''">
			and a.city_code = #{cityCode}
		</if>
		<if test="districtCode != null and districtCode != ''">
			and a.district_code = #{districtCode}
		</if>
		<if test="createStartTime != null and createStartTime != ''">
			and date_format(a.create_time,'%Y-%m-%d') >= #{createStartTime}
		</if>
		<if test="createEndTime != null and createEndTime != ''">
			and date_format(a.create_time,'%Y-%m-%d') <![CDATA[<=]]>
			#{createEndTime}
		</if>
		<if test="useRateStart != null and useRateStart != ''">
			and IFNULL(ROUND(a.occupied_amount / a.space_amount * 100),0) >= #{useRateStart}
		</if>
		<if test="useRateEnd != null and useRateEnd != ''">
			and IFNULL(ROUND(a.occupied_amount / a.space_amount * 100),0) <![CDATA[<=]]>#{useRateEnd}
		</if>
		<if test="createUser != null and createUser != ''">
			and a.create_user = #{createUser}
		</if>
		<if test="idList !=null and idList.size>0">
			and a.id in
			<foreach collection="idList" index="index" item="item" open="("
				separator="," close=")">
				#{item}
			</foreach>
		</if>
	</sql>

	<!-- 根据仓库ID获取库容信息 -->
	<select id="selectStorageInfoById" resultMap="warehouseCustomerMap"
		parameterType="java.lang.Integer">
		SELECT
		a.id,
		a.name,
		a.short_name,
		a.province_name,
		a.city_name,
		a.district_name,
		a.space_amount,
		a.warning_type,
		a.warning_empty_amount,
		a.warning_occupied_percent
		FROM tb_warehouse a
		WHERE
		a.id=#{id}
	</select>
	<!-- 仓库与客户关系列表查询-->
	<select id="findCustomerInfoByWarehouseId"
		resultType="com.anji.allways.business.vo.WarehouseLinkCustomerVO" parameterType="java.util.Map">
		SELECT
		b.id,
		b.customer_id,
		b.warehouse_id,
		b.space_amount,
		tb_customer.name as customer_name
		FROM tb_warehouse_link_customer b
		inner join tb_customer on
		(tb_customer.id=b.customer_id)
		WHERE
		b.warehouse_id=#{warehouseId}
		order by b.id desc
	</select>
	
	<!-- 编辑库容时，更新仓库信息 -->
	<update id="updateByIdForStorage" parameterType="java.util.Map">
		update tb_warehouse
		set 
		<if test="spaceAmount != null">
		 space_amount = #{spaceAmount,jdbcType=INTEGER},
		</if>
		<if test="warningType !=null">
		 warning_type = #{warningType,jdbcType=INTEGER},
		</if>
		<if test="warningEmptyAmount !=null">
		 warning_empty_amount = #{warningEmptyAmount,jdbcType=INTEGER},
		</if>
		<if test="warningOccupiedPercent !=null">
		 warning_occupied_percent = #{warningOccupiedPercent,jdbcType=REAL},
		</if>
		update_user = #{userId,jdbcType=INTEGER},
		update_time = current_timestamp()
		where
		 id = #{id}
	</update>
	
	<!-- 仓库关系分页查询 -->
	<select id="queryWarehouseRelationInfos" resultMap="BaseResultVOMap"
		parameterType="com.anji.allways.business.entity.WarehouseEntity">
		select
		id,
		name,
		short_name,
		status,
		parent_id,
		create_time
		from tb_warehouse
		where 1=1
		<if test="name != null and name != ''">
			and (name like concat("%",#{name},"%")
			or short_name like concat("%",#{name},"%") )
		</if>
		<if test="idList !=null and idList.size>0">
			and id in
			<foreach collection="idList" index="index" item="item" open="("
				separator="," close=")">
				#{item}
			</foreach>
		</if>
		<if test="createUser != null and createUser != ''">
			and create_user = #{createUser}
		</if>
		order by create_time desc
		<if test="dbIndex != null and dbNumber != null">
			limit #{dbIndex},#{dbNumber}
		</if>
	</select>
	<!-- 仓库关系分页查询件数查询 -->
	<select id="queryWarehouseRelationInfosCount" resultType="java.lang.Integer"
		parameterType="com.anji.allways.business.entity.WarehouseEntity">
		select
		count(1)
		from tb_warehouse
		where 1=1
		<if test="name != null and name != ''">
			and (name like concat("%",#{name},"%")
			or short_name like concat("%",#{name},"%") )
		</if>
		<if test="idList !=null and idList.size>0">
			and id in
			<foreach collection="idList" index="index" item="item" open="("
				separator="," close=")">
				#{item}
			</foreach>
		</if>
		<if test="createUser != null and createUser != ''">
			and create_user = #{createUser}
		</if>
	</select>
	<!-- 保存编辑后的仓库信息(仓库管理) -->
	<update id="updateWarehouseForManageById" parameterType="com.anji.allways.business.entity.WarehouseEntity">
		update tb_warehouse
		<trim suffixOverrides="," >
		<set>
			<if test="name != null and name !=''">
				name = #{name,jdbcType=VARCHAR},
			</if>
			<if test="shortName != null and shortName !=''">
				short_name = #{shortName,jdbcType=VARCHAR},
			</if>
			<if test="parentId != null">
				parent_id = #{parentId,jdbcType=INTEGER},
			</if>
			<if test="provinceName != null and provinceName != ''">
				province_name = #{provinceName,jdbcType=VARCHAR},
			</if>
			<if test="provinceCode != null and provinceCode != ''">
				province_code = #{provinceCode,jdbcType=VARCHAR},
			</if>
			<if test="cityName != null and cityName != ''">
				city_name = #{cityName,jdbcType=VARCHAR},
			</if>
			<if test="cityCode != null and cityCode != ''">
				city_code = #{cityCode,jdbcType=VARCHAR},
			</if>
			<if test="districtName != null and districtName != ''">
				district_name = #{districtName,jdbcType=VARCHAR},
			</if>
			<if test="districtCode != null and districtCode != ''">
				district_code = #{districtCode,jdbcType=VARCHAR},
			</if>
			<if test="address != null and address !=''">
				address = #{address,jdbcType=VARCHAR},
			</if>
			<if test="longitude != null">
				longitude = #{longitude,jdbcType=REAL},
			</if>
			<if test="latitude != null">
				latitude = #{latitude,jdbcType=REAL},
			</if>
			<if test="contactor != null and contactor !=''">
				contactor = #{contactor,jdbcType=VARCHAR},
			</if>
			<if test="contactorMobile != null and contactorMobile !=''">
				contactor_mobile = #{contactorMobile,jdbcType=VARCHAR},
			</if>
			<if test="businessStartTime != null and businessStartTime !=''">
				business_start_time = #{businessStartTime,jdbcType=VARCHAR},
			</if>
			<if test="businessEndTime != null and businessEndTime !=''">
				business_end_time = #{businessEndTime,jdbcType=VARCHAR},
			</if>
			<if test="updateUser != null">
				update_user = #{updateUser,jdbcType=INTEGER},
			</if>
			<if test="updateTime != null">
				update_time = #{updateTime,jdbcType=TIMESTAMP},
			</if>
		</set>
		</trim>
		where id = #{id,jdbcType=INTEGER}
	</update>

   <!-- 获取客户名称下拉列表名称（仓库对应的客户信息)-->
   <select id="queryCustomerForDict" resultType="com.anji.allways.business.vo.DictVO" parameterType="Map" >
		select DISTINCT t.id as code, t.name
		from tb_customer  t 
		where t.status =1
		<if test="name != null and name != ''">
			and t.name like concat("%",#{name},"%")
		</if>
		order by t.id desc
   </select>
   <select id="getWarehouseByParentID" resultMap="BaseResultMap" parameterType="java.lang.Integer">
		SELECT * FROM tb_warehouse
		WHERE parent_id =
		#{parentId,jdbcType=INTEGER}
		and status=1
		ORDER BY create_time DESC
	</select>
	
	<select id="getAllWarehouse" resultMap="BaseResultMap">
		SELECT * FROM tb_warehouse
		WHERE status=1
		ORDER BY create_time DESC
	</select>
	
	<!--  校验仓库是否存在已入库的入库计划单或未完成的出库计划单 -->
    <select id="checkWarehouseStatus" resultType="java.lang.String" parameterType="java.util.Map" >
	    select 
	    distinct t.name
	    from tb_warehouse t
	    inner join tb_storage_plan t1 on
	    (t1.warehouse_id = t.id and
	    t1.status = 1)
	    inner join tb_delivery_plan t2 on
	    (t2.warehouse_id = t.id and
	    t2.status <![CDATA[<>]]> 5)
	    where 
	    t.status = 1
	    and t.id in
	    <foreach collection="idList" index="index" item="item" open="(" separator="," close=")">
	        #{item}
	    </foreach>
    </select>
    
    <select id="getAllChildrenWarehouse" resultMap="BaseResultMap">
		SELECT * FROM tb_warehouse
		WHERE id NOT IN (SELECT parent_id FROM tb_warehouse)
		GROUP BY id
	</select>
	
	<select id="getAllParentWarehouse" resultMap="BaseResultMap">
		SELECT * FROM tb_warehouse
		WHERE id NOT IN (SELECT id FROM tb_warehouse
		WHERE id NOT IN (SELECT parent_id FROM tb_warehouse)
		GROUP BY id)
		GROUP BY id
	</select>
	
</mapper>